---
title: "35 - 《按需 externals》"
date: 2022-01-12
url: https://sorrycc.com/dynamic-externals
---

发布于 2022年1月12日

# 35 - 《按需 externals》

昨晚学到的一点。应该是 webpack 5 的新功能之一，之前没留意，webpack 官方文档也没写清楚。

先看通常怎么用 externals，

1、配置 externals，比如 `externals: { foo: 'Foo' }`  
2、html 里加上相关 script，比如 `<script src="//cdn/foo.js"></script>`  
3、代码里 `import 'foo'` 时就不会编译 foo，而是从 `//cdn/foo.js` 引

问题是，尽管 foo 可能只在某个路由的某个按钮点击后才会用到，而由于 `//cdn/foo.js` 写在 html 里，不是按需的，所以需要以页面的加载速度和首屏时间为代价。

解法推荐官方方案，

1、配置 externals，比如 `externals: { foo: ['script //cdn/foo.js', 'Foo'] }`  
2、无需处理 html  
3、代码里 import ‘foo’ 时就不会编译 foo，而是从 //cdn/foo.js 按需引

示例代码参考 [https://github.com/umijs/umi-next/commit/7e129cb56f783da42bdaebeb8141f1cb182b2be9](https://github.com/umijs/umi-next/commit/7e129cb56f783da42bdaebeb8141f1cb182b2be9) ，官网文档参考 [https://webpack.js.org/configuration/externals/#externalstypescript](https://webpack.js.org/configuration/externals/#externalstypescript) 。

p.s. 之前还有看到一个解是 [https://github.com/fengsx/umi-plugin-runtime-import](https://github.com/fengsx/umi-plugin-runtime-import) ，供参考。
