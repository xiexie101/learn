---
title: "365 - 《Mako 开发日志（5） - Why Mako》"
date: 2023-11-02
url: https://sorrycc.com/mako-devlog-05
---

发布于 2023年11月2日

# 365 - 《Mako 开发日志（5） - Why Mako》

1、背景是同事在重庆前端交流会 2023 上分享了「Rust 在前端构建高性能前端打包工具」，有人评论「还不如直接基于 Rspack 封装个 Rsfish，重复造轮子」（后来好像删了？），我回复了「评估过 Rspack，不满足内部需求。如果写一个功能类似的工具就是重复造轮子，那有了 Webpack 就没必要有 Rollup、Vite、Parcel、esbuild、… 了」，群里有人感兴趣，我就展开写下原因。

![](https://img.alicdn.com/imgextra/i3/O1CN01eZJi8J1XUcB9balsp_!!6000000002927-0-tps-1008-230.jpg)

2、先说「重复造轮子」，这种无脑的评论可以针对任何一个工具或产品。比如看到 Linux，有 Unix 了，重复造轮子；比如看到 Vue，有 Angular 了，重复造轮子；比如看到 Preact、Solid，有 React 了，重复造轮子；比如看到 Rollup、Vite、Parcel、esbuild…，有 Webpack 了，重复造轮子；比如看到 Next.js，有 PHP 了，重复造轮子。但是，轮子有高低级之分，有些是为了造而造，有些则是问题驱动。

3、回到 Mako。项目 Kickoff 时就调研过社区的各个方案，结论是不合适。Farm 开发人员少，没大厂背书，落地少 edge case 会是个问题；Rspack 不喜欢其兼容 Webpack 的设计，兼容意味着权衡和潜在的性能消耗，既然重新用 Rust 写了，不如就更彻底一些；Turbopack 是最想和他摩擦出火花的一个，但无奈太封闭，商业公司的开源商业气息有点重，Next.js only，且当时只有 dev，同时也是我们太菜，看了好久他的代码没看懂。

4、我们在蚂蚁工作，Mako 肯定也是蚂蚁业务优先的。随着 Mako 开发的深入，以及和其他团队的沟通，Mako 对于我们来说，可能不仅仅是类 Webpack 构建工具那么简单。兼容 Webpack 不是我们想要的，服务 Umi 和蚂蚁的业务，解其中遇到的问题才是。

5、功能层除了纯粹的构建器，还会有 Bundless（Transpile）和浏览器构建的支持。Bundless 是文件到文件的编译，esbuild 也有，但需要支持 preserveModules，我在 [325 - 《preserveModules》](https://sorrycc.com/preserve-modules) 有写，具体场景就不展开了；浏览器构建是指打包出 WASM 格式让 Mako 可以在浏览器中跑，这对于 PlayGround 平台、低码平台来说，可以带来不一样的体验。

6、说下 Mako 的定位，构建工具是他的第一个里程碑，但我们更希望他的终态是一个框架。几个原因，1）构建快了，但框架层慢，给开发者的体验依旧不佳，2）现在的框架通常都有较重的预编译层，需要分析源码、依赖并做一些转换和编译，等等，所以对于框架来说，不仅仅只有构建层是重 CPU 的操作，而如果框架和构建工具分类，很多事情得重复做，这是一种浪费。

7、还有一点考虑是 JS 的边界在哪。[271 - 《手撕源码 29：Farm》](https://sorrycc.com/source-29-farm) 里我也有提这个，「这些方案有很多可以对比的点，其中有一个是 node 和 rust 的边界线在哪，或者说方案中 rust 的占比是多少，我理解是 turbopack > farm > rspack。turbopack 是全部 rust，farm 和 rspack 的区别是 hook 的实现在哪，rspack 是在 node，而 farm 是在 rust。」。我希望 Mako 的 Rust 占比是近 100% 的。

8、基于上一点，这里也涉及到用户使用层要不要开 JS 的口子。[364 - 《作为前端开发者，到底有没有必要学 Rust》](https://sorrycc.com/learn-rust-or-not) 里有提到个真实例子，「比如之前有人和我说某 Rust 构建工具比 Webpack 还慢，我问为啥，他说在 Rust 构建工具的基础上又增加了 Babel 满足业务需求，哈哈。」只要开了口子，用户的使用角度绝对会超出你的想象。Mako 我想把这个口子收的足够小，当然，这肯定会以牺牲功能和兼容性为代价。

9、上面那个视频下有个评论说的不错，「各家都得有自己的东西，以保证自己的技术主动性，毕竟技术无公司边界，但是人有。」假如我们现在基于 Farm、Rspack 或 Turbopack，想在里面加 Bundless、WASM 产物、[355 - 《optimizePackageImports》](https://sorrycc.com/optimize-package-imports) 等非纯粹的构建功能时，肯定没那么容易，大家坐的椅子不同，优先级和决策因子也都不同。同时我们做 Mako 还有个目的就是，希望以项目养人，培养出一批熟悉 Rust、编译、构建、框架的同学。

个人观点，仅供参考。国内社区风气不好，所以本文星球 only，请勿截图转发。

参考：  
[https://www.bilibili.com/video/BV15c411d7FZ/](https://www.bilibili.com/video/BV15c411d7FZ/)
