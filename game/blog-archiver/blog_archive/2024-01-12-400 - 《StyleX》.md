---
title: "400 - 《StyleX》"
date: 2024-01-12
url: https://sorrycc.com/stylex
---

发布于 2024年1月12日

# 400 - 《StyleX》

1、StyleX 是什么？他是 Meta 新开源的 CSS in JS 方案，更严格来说，他是 Atom CSS in JS 方案。虽然他刚开源，生态还很新，但它并不是一个新库，它支持了所有 Meta 网站，包括 Facebook、Instagram、WhatsApp 和 Threads 等，见下图，这种 Classname 就是 Atom CSS 的表现。

![](https://img.alicdn.com/imgextra/i3/O1CN01c9lFPr1bwKdKCqyDR_!!6000000003529-2-tps-2194-1324.png)

2、大多 CSS in JS 方案都存在几个问题。

1）性能。性能是指在运行时通过 JS 把样式解析出来并插入到 DOM 里，这可能会带来较大的成本，所以不少库都在往「0 运行时」转，比如 Vanilla Extract 和 Panda，StyleX 也是此类。

2）兼容。比如对 React SSR、流式 SSR、RSC 的支持，尤其是 RSC，应该不少方案都还不支持。StyleX 应该是支持的，未具体验证。

3）产物尺寸。传统的 CSS in JS 方案，产物尺寸会随着项目大小线性增长，而原子化（Atom）的方案通常能减少 50%-70%。StyleX 会生成一个高度优化的原子化的单一 CSS 包。

4）类型安全。除 stylex.create 和 stylex.props 两个主 API 本身类型完整外，stylex 还提供了 StyleXStyles、StyleXStylesWithout 等类型接口让你对类型有更多控制权，比如只接受 color 属性，比如只接受除 margin 之外的所有属性等。

StyleX 除了解决以上问题，在产物确定性、API 设计、框架无关、模块化和可组合性等方面都有考虑。

3、StyleX 的问题？我觉得有几个，1）生态，毕竟刚出的，2）工程化，工具还没有 rust swc 的实现，接入意味着用 Babel 做文件的额外转换，如果是大项目，肯定会慢很多，3）脚手架代码多，StyleX 的设计理念之一是「可读性和可维护性优于简洁性」，为了可读性和可维护性，你可能需要写更多代码，4）Dev 和 Build 的不一致性，如果你的项目比较大，这可能是个大问题，比如让定位样式问题变得复杂，让 Debug 成本变高。

4、如何上手 StyleX？

1）除 Next.js 外，手动配还是有点麻烦的。webpack 用 `@stylexjs/webpack-plugin`，next.js 用 `@stylexjs/nextjs-plugin`。

2）定义样式。支持伪类、伪元素、media-query 等。

```tsx
import * as stylex from '@stylexjs/stylex';
const styles = stylex.create({
  base: {
    fontSize: 16,
    lineHeight: 1.5,
    color: 'rgb(60,60,60)',
  },
  highlighted: {
    color: 'rebeccapurple',
  },
});
```

3）使用样式。

```tsx
<div {...stylex.props(styles.base)} />
```

支持合并。

```tsx
<div {...stylex.props(styles.base, styles.highlighted)} />;
```

4）主题。通常是新建 `tokens.stylex.js`，然后用 `stylex.defineVars` 定义 tokens。由于其和编译器绑定使用，还得注意写法，比如不能用 default export。

定义 Tokens。

```tsx
import * as stylex from '@stylexjs/stylex';
export const tokens = stylex.defineVars({
  primaryText: 'black',
  secondaryText: '#333',
  accent: 'blue',
  background: 'white',
  lineColor: 'gray',
  borderRadius: '4px',
  fontFamily: 'system-ui, sans-serif',
  fontSize: '16px',
});
```

定义主题。

```tsx
import * as stylex from '@stylexjs/stylex';
import {colors, spacing} from './tokens.stylex';

const DARK = '@media (prefers-color-scheme: dark)';
export const dracula = stylex.createTheme(colors, {
  primaryText: {default: 'purple', [DARK]: 'lightpurple'},
  secondaryText: {default: 'pink', [DARK]: 'hotpink'},
  accent: 'red',
  background: {default: '#555', [DARK]: 'black'},
  lineColor: 'red',
});
```

使用主题和 Tokens。

```tsx
import * as stylex from '@stylexjs/stylex';
import {colors, spacing} from '../tokens.styles';
import {dracula} from '../themes';

const styles = stylex.create({
  container: {
    color: colors.primaryText,
    backgroundColor: colors.background,
    padding: spacing.medium,
  },
});

<div {...stylex.props(dracula, styles.container)}>{children}</div>;
```

5、一些 Demo。

[https://github.com/facebook/stylex/tree/main/apps/nextjs-example](https://github.com/facebook/stylex/tree/main/apps/nextjs-example)  
[https://codesandbox.io/p/devbox/cocky-tu-x7twwd?file=%2FApp.tsx%3A17%2C1-18%2C1](https://codesandbox.io/p/devbox/cocky-tu-x7twwd?file=%2FApp.tsx%3A17%2C1-18%2C1)  
[https://github.com/nmn/nextjs-app-dir-stylex](https://github.com/nmn/nextjs-app-dir-stylex)

参考：  
[StyleX: Meta’s Solution To CSS At Scale - YouTube](https://www.youtube.com/watch?v=6ZDiGtg1jN4)  
[GitHub - facebook/stylex: StyleX is the styling system for ambitious user interfaces.](https://github.com/facebook/stylex)
