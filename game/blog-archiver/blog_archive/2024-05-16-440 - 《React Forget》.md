---
title: "440 - 《React Forget》"
date: 2024-05-16
url: https://sorrycc.com/react-forget
---

发布于 2024年5月16日

# 440 - 《React Forget》

> 虽然官方已改名 React Compiler，但还是喜欢称之为 Forget。

1、Umi 4.2.4 已支持 React 19 和 React Forget，见下方两个 PR。

[https://github.com/umijs/umi/pull/12395](https://github.com/umijs/umi/pull/12395)  
[https://github.com/umijs/umi/pull/12396](https://github.com/umijs/umi/pull/12396)

如果想要尝鲜，可以这样。（注：1）mfsu 和 mako 功能暂不支持 forget，2）forget 需要 react 19）

```bash
pnpm i umi react@rc react-dom@rc -D
npx umi g page index
npx umi config set mfsu false
npx umi config set forget {}
npx umi dev
```

然后打开浏览器中的 React Dev Tools，应该可以看到 Page 组件被标记为 Memo。

![](https://res.cloudinary.com/sorrycc/image/upload/v1715828258/blog/biwtduyu.png)

2、非 Umi 场景，如果要接入 Forget 也非常简单，只要加一个 Babel 插件即可。

```bash
npm install babel-plugin-react-compiler
```

```ts
plugins: [
  ['babel-plugin-react-compiler', ReactCompilerConfig]
]
```

其中 ReactCompilerConfig 有几个配置，应该是为了方便大家逐步接入 Forget 用，比如从目录开始，或者基于注解接入。

1）sources 配置。

```ts
const ReactCompilerConfig = {
  sources: (filename) => {
    return filename.indexOf('src/path/to/dir') !== -1;
  },
};
```

2）选入模式。

```ts
const ReactCompilerConfig = {
  compilationMode: "annotation"
};
```

```tsx
export default function App() {
  "use memo";
  // ...
}
```

3）逃生舱。

```ts
function SuspiciousComponent() {
  "use no memo"; // opts out this component from being compiled by React Compiler
  // ...
}
```

在接入之前，还可以先做个兼容性检测。启用 `<StrictMode>` 并遵循意味着更有可能遵循 [React 规则](https://react.dev/reference/rules)。

```bash
npx react-compiler-healthcheck
```

3、源码。

Forget 的源码见 [https://github.com/facebook/react/tree/main/compiler](https://github.com/facebook/react/tree/main/compiler) 。其中包含 packages 目录的 Babel 版本和 crates 目录的 Rust 版本。但目前能 Work 的应该只有 Babel 版本。

![](https://res.cloudinary.com/sorrycc/image/upload/v1715867904/blog/3ocxrdof.png)

4、调试。

Forget 有个在线的调试工具，见 [https://playground.react.dev/](https://playground.react.dev/) 。可以看到编译后的 JS、SourceMap，以及编译器底层状态。

![](https://res.cloudinary.com/sorrycc/image/upload/v1715843028/blog/55koruyi.png)

参考：  
\[\[译：我们对 React Forget 了解多少？\]\]  
\[\[译：React Compiler\]\]  
[https://github.com/facebook/react/tree/main/compiler/crates](https://github.com/facebook/react/tree/main/compiler/crates)  
[https://react.dev/learn/react-compiler](https://react.dev/learn/react-compiler)  
[https://github.com/vercel/next.js/pull/65804](https://github.com/vercel/next.js/pull/65804)

https://github.com/reactwg/react-compiler/discussions/7 \[React Compiler With React 18\](https://jherr2020.medium.com/react-compiler-with-react-18-1e39f60ae71a)
