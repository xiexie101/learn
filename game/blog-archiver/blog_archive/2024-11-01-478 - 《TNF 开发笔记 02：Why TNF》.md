---
title: "478 - 《TNF 开发笔记 02：Why TNF》"
date: 2024-11-01
url: https://sorrycc.com/tnf-02
---

发布于 2024年11月1日

# 478 - 《TNF 开发笔记 02：Why TNF》

> TNF 还是雏形，还是脑子里的想法，所以这篇文章虽然写的是 Why TNF，实际上是对 TNF 的展望，是我对于理想框架的想法。

1、好的框架应该是如何？

我脑暴了一些关键词，不分先后，持续补充。

*   功能完备
*   场景完备
*   Edge Case 覆盖
*   速度和内存占用（Rust 等）
*   DX（开发者友好）
*   Type Safe
*   框架开发者友好
*   性能
*   简单
*   路由
*   安全（Doctor）
*   规则（强约束）
*   最佳实践
*   组装式（开发者对框架的把控度）
*   RSC
*   SSR（流和非流）
*   Server Functions
*   React 19
*   兼容（？）
*   做细（多雕花？）
*   AI（AI 如何助力前端？）
*   多端友好（MPA）
*   生态友好（TailwindCSS、数据流、shadcn/ui、Css in JS、TanStack Query、CSS Modules 等）
*   插件体系
*   …

2、Umi 是大而全，我希望 TNF 应是小而美的。现在的前端框架大多是 Server 优先的，这让本应简单的 CSR 变得复杂，而国内前端大多又都是 CSR 的。TNF 会专注解 CSR 的问题，为此提供极致的研发体验（DX）和产品体验（UX）。DX 包含的东西很多，比如框架速度和内存占用、错误处理、边界 Case 覆盖等，UX 框架层能做的主要是产物性能。同时基于此，要容易扩展，且对 SSR、RSC 和多端等场景友好。

3、大多中台项目对产物性能不敏感（但也不能太差…），而大多对 C 的产品却是很敏感的。我希望 TNF 默认是产物性能友好的。影响产物性能的因素是多维的，我觉得可能有以下这些。

1）产物尺寸。比如 tree shaking 和压缩的效果、产物 gzip 友好度、依赖库是否 tree shaking 友好（比如 lodash-es 会好于 lodash）等。  
2）拆包策略。  
3）import() 拆代码的合理性。举几个例子。比如路由通常有 load 和 component，load 应该随主包不 import()，而 component 应该 import() 按需加载。比如根路由或 layout 路由应始终加载所以不应该 import()。比如多层级的路由应通过 magic comment 合成一个而不是多个，以避免 chunk 太多导致请求过多从而应该加载速度。  
4）preload。默认情况下，preload 应基于用户意图，比如当用户 hover 或 touchmove 时，应该 preload 对应 link 的路由。同时，还会有其他的 preload 策略以满足不同的场景。  
5）swr。看场景，比如一些数据变更不频繁的场景，路由之间来回跳转时应先用缓存再刷新。  
6）大包预警。比如 monaco-editor、g2 等编辑器库和图形库，不做按需会影响主体内容的渲染，应予以提醒。  
7）cdn 或容器 cache 。  
8）减少框架级不必要的 re-render。  
9）…

TanStack Router 做了 3、4、5，合理利用可以让产品性能更好。

4、框架速度是开发者敏感的，小项目还好，上了大依赖的项目差异就比较明显了。

1）构建部分，很多社区框架都无脑上 Vite，但大厂的不行，因为要尽量保证 dev 和 build 的产物一致性。  
2）除了构建，框架也还有其他慢的地方，比如 Umi 中有的，配置的解析、项目文件的 import export 分析、dva model 文件的查找、icons 方案的 ast 分析、mfsu 方案中提前找依赖使用情况等，只要涉及 ast，就会慢。这部分，TNF 也会上 Rust。  
3）除了框架启动速度，框架安装速度也需要考虑，打包依赖就是其中一种比较好的做法。

5、技术栈和最佳实践。

列下目前的选择。

*   React 19
*   路由，TanStack Router
*   请求方案，TanStack Query
*   CSS 方案，Tailwind + CSS Modules（+ Less ?）
*   构建，Mako（+ Webpack / Vite ？）
*   数据流，Zustand or Valtio or ??
*   组件库，antd / shadcn ui
*   Server，Nitro
*   Mock，[MSW](https://mswjs.io/)
*   微前端，qiankun
*   配置，zod
*   测试，Vites
*   …
