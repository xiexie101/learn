---
title: "295 - ã€Šconst å’Œä¸å¯å˜æ€§ã€‹"
date: 2023-05-06
url: https://sorrycc.com/const-and-immutable
---

å‘å¸ƒäº 2023å¹´5æœˆ6æ—¥

# 295 - ã€Šconst å’Œä¸å¯å˜æ€§ã€‹

æ¥ç€ [The â€œconstâ€ Deception](https://www.joshwcomeau.com/javascript/the-const-deception/) è¿™ç¯‡æ–‡ç« æ‰©å±•ä¸‹ï¼Œè¡¥å……ä¸‹ JavaScript åŸºç¡€çŸ¥è¯†ã€‚

1ã€const å£°æ˜çš„å˜é‡å°±ä¸å¯å˜å—ï¼Ÿä¸æ˜¯ã€‚const åªæ˜¯é˜»æ­¢äº†å˜é‡è¢«é‡æ–°èµ‹å€¼ï¼Œä½†ä¸èƒ½é˜»æ­¢å˜é‡æŒ‡å‘çš„éåŸå§‹ç±»å‹çš„å€¼å‘ç”Ÿå˜åŒ–ã€‚

å¯ä»¥é˜»æ­¢å˜é‡ a è¢«é‡æ–°èµ‹å€¼ã€‚

```ts
const a = 1;
a = 2; // è¿™é‡Œä¼šæŠ¥é”™
```

ä½†å½“ a æŒ‡å‘éåŸå§‹ç±»å‹æ—¶ï¼Œå€¼æ˜¯å¯ä»¥å˜æ›´çš„ã€‚

```ts
const a = { b: 1 };
a.b = 2;
console.log(a); // { b: 2 }
```

2ã€é‚£å¦‚ä½•é˜»æ­¢ä¸Šè¿°åœºæ™¯å‘ç”Ÿå˜åŒ–ï¼Ÿæœ‰å‡ ç§æ–¹æ³•ï¼Œ1ï¼‰Object.freezeï¼Œ2ï¼‰TypeScript çš„ as const ã€‚

3ã€å…ˆçœ‹ Object.freezeã€‚ä»–å¯ä»¥é˜»æ­¢éåŸå§‹ç±»å‹çš„å€¼è¢«ä¿®æ”¹ã€‚

```ts
const a = { b: 1 };
Object.freeze(a);
a.b = 2;
console.log(a); // { b: 2 }
```

ä¸€äº› Tipsã€‚

1ï¼‰è¢«ä¿®æ”¹æ—¶ä¸ä¼šæŠ¥é”™ï¼Œåªæ˜¯é™é»˜çš„ä¿æŒåŸå§‹å€¼ï¼Œé™¤éä½ å¼€äº†ä¸¥æ ¼æ¨¡å¼ï¼Œæ­¤æ—¶ä¼šæŠ› TypeErrorã€‚

```ts
const a = { b: 1 };
Object.freeze(a);
(() => {
	'use strict';
	a.b = 2;
})();
console.log(a);
```

2ï¼‰Freeze æ˜¯ Shadow çš„ï¼Œä¸æ˜¯ Deep çš„ã€‚

```ts
const a = { b: 1, c: { d: 1 } };
Object.freeze(a);
a.b = 2;
a.c.d = 2;
console.log(a); // { b: 1, c: { d: 2 } }
```

å¦‚æœè¦ Deep Freeze ä¸€ä¸ªå¯¹è±¡åº”è¯¥æ€ä¹ˆåŠï¼Ÿè‡ªå·±å†™ä¸ªé€’å½’ï¼Œé‡åˆ° Object like çš„å€¼æ—¶ç»§ç»­ Object.freezeï¼Œæˆ–è€…ç”¨ [deep-freeze-strict](https://github.com/jsdf/deep-freeze) è¿™ä¸ªåº“ã€‚

3ï¼‰å’Œ Object.freeze ç±»ä¼¼çš„è¿˜æœ‰ä¸ª Object.sealã€‚åŒºåˆ«æ˜¯ï¼Œåè€…å°è¿‡çš„å¯¹è±¡ï¼Œæ—¢æœ‰å±æ€§æ˜¯å¯ä¿®æ”¹çš„ï¼Œåªæ˜¯ä¸èƒ½æ–°å¢æˆ–åˆ é™¤å±æ€§ã€‚seal æ˜¯å¯†å°çš„æ„æ€ï¼Œå¾ˆå½¢è±¡ã€‚

```ts
const a = { b: 1 };
Object.seal(a);
a.b = 2;
a.c = 1;
console.log(a); // { b: 2 }
```

4ã€å…·ä½“æœ‰å“ªäº›åœºæ™¯ä¸‹ä¼šç”¨åˆ° Object.freezeï¼Ÿé€šå¸¸æœ‰è¿™äº›ã€‚

1ï¼‰é…ç½®å¯¹è±¡ã€‚ä½ ä¼šæœŸæœ›åœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œè®©é…ç½®ä¿æŒä¸å˜ï¼Œä»¥å…è¢«æ„å¤–ä¿®æ”¹åå¯¼è‡´é”™è¯¯æˆ–ä¸ä¸€è‡´ã€‚æ¯”å¦‚ `const config = { apiUrl: 'xxx' }; Object.freeze(config);` ã€‚

2ï¼‰å¸¸é‡å¯¹è±¡ã€‚æ¯”å¦‚ `const color = { BLUE: '#FF0000' }; Object.freeze(color);` ã€‚

3ï¼‰å…¨å±€çŠ¶æ€ã€‚æ¯”å¦‚ `const globalState = { appName: 'xx', version: 'xxx' }; Object.freeze(globalState);` ã€‚

4ï¼‰å†…éƒ¨å®ç°ã€‚å†…éƒ¨å±æ€§æˆ–æ–¹æ³•ï¼Œé€šå¸¸ä¸ä¼šä¸å¸Œæœ›è¢«å¤–éƒ¨ä»£ç ä¿®æ”¹ã€‚æ¯”å¦‚ `const foo = { _privateBar: () => {} }; Object.freeze(foo);`

5ã€å¦‚æœä½ ç”¨ TypeScriptï¼Œä¹Ÿå¯ä»¥ç”¨ `as const` æ–­è¨€ã€‚

```ts
const a = { b: 1 } as const;
a.b = 2; // ç¼–è¯‘æ—¶æŠ¥é”™
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒTypeScript çš„æ–¹æ¡ˆæ˜¯ç¼–è¯‘æ—¶ï¼Œä¸æ˜¯è¿è¡Œæ—¶çš„ã€‚ä»–åªèƒ½é˜»æ­¢å½“å‰ä»£ç åº“é‡Œç”¨ TypeScript ç¼–å†™ä»£ç æ—¶ä¼šåšå˜æ›´ï¼Œä½†ä¸èƒ½é˜»æ­¢ä¾èµ–ä»£ç æˆ–è€…è¿è¡Œæ—¶çš„å…¶ä»–ä»£ç ä¿®æ”¹ä½ çš„å˜é‡çš„å€¼ã€‚

å‚è€ƒï¼š  
[The â€œconstâ€ Deception](https://www.joshwcomeau.com/javascript/the-const-deception/)  
[Object.freeze() - MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze)  
[Object Integrity: An In-depth Look at Object.freeze ğŸ¥¶ and Object.seal ğŸ¤ | by Shilpa Syal | Medium](https://medium.com/@shilpasyal55/object-integrity-an-in-depth-look-at-object-freeze-and-object-seal-41d3388b64f6)
