---
title: "240 - 《简繁转换的 3 个方案》"
date: 2023-01-08
url: https://sorrycc.com/simplified-traditional-chinese
---

发布于 2023年1月8日

# 240 - 《简繁转换的 3 个方案》

这周看到了几次繁简体转换的案例，于是研究了下。

繁简体转换有多种方法，有比较重的，有比较轻的，有跑在 Node 里的，有跑在 Browser 里的，有甚至直接一行 CSS 就能完成转换的。

1、例行先问下 chatgpt，他给的答案是 opencc，这应该是最准确的方案。但缺点是重，需安装 npm 包，然后还有 node-gyp 编译，我本地还编译失败了。

```ts
import { OpenCC } from 'opencc';
const converter: OpenCC = new OpenCC('s2t.json');
await converter.convertPromise('汉字');
```

opencc 还有一些非官网的其他实现，比如 purejs 的，wasm 的等等，但看下来都感觉比较重，那有没有轻量点的方案呢？问了 chatgpt 之后，告诉我可以尝试用自定义的字词映射表。

2、这周翻 [antgroup.com](http://antgroup.com) 代码时也是看到了相似的字词表映射方案，优点是轻，2000+ 的映射表只要 50K+（gzip 前），缺点是覆盖面窄，比如不支持一些生僻字。

```ts
const TongWen = {
  '\u00b7': '\u2027',  
  '\u2015': '\u2500',  
  '\u2016': '\u2225',
  // 这里省略 2000+ 行的字映射表
  // 可以在 https://github.com/tongwentang/tongwen-core/tree/master/dictionaries 找到
};
const words = {  
  '\u8054\u7cfb': '\u806f\u7e6b',  
  '\u5173\u7cfb': '\u95dc\u4fc2',  
};  
function toTrad(itxt: string) {  
  let newItxt = itxt;  
  if (typeof newItxt !== 'string') {  
    return newItxt;  
  }  
  const replaceFn = (s) => {  
    return s in TongWen ? TongWen[s] : s;  
  };  
  Object.keys(words).forEach((word) => {  
    newItxt = newItxt.replace(new RegExp(word, 'g'), words[word]);  
  });  
  return newItxt.replace(/[^\x00-\xFF]/g, replaceFn);  
}
```

还有个优点是可以自定义，比如在简繁转化时，「阿里巴巴」被转换为「阿裡巴巴」，我们期望在繁体时依旧展示为「阿里巴巴」，所以可以考虑把「里」的转化注释。

3、更轻的方案是 CSS 方案。这周我在用 [read.readwise.com](http://read.readwise.com) 时有遇到一个问题，「明明是中文的书籍我做的高亮，显示时却是用的繁体，然后我复制内容或者导出也是繁体，这是为啥？」。遇到这个问题，我 google 了下，然后通过 stylus 加了一行 `font-feature-settings: inherit` 后解决（不知为啥？有知道的可以告诉我）。

然后又找到 zxx 的文章《一行CSS实现全站中文简繁转换》，通过字体 + `font-variant-east-asian: traditional;` 属性即可实现字体切换，原理应该是字体本身包含简繁体，然后支持通过特性切换。

```css
body {
  font-family: 'PingFang SC';
  font-variant-east-asian: traditional;
}
```

我自己试验发现，除了「PintFang SC」，「Apple Color Emoji」也是支持简繁切换的，这也是 [read.readwise.com](http://read.readwise.com) 里用的字体。另外，不清楚 Windows 机器上是否有这种功能的字体，（如果你知道，请告诉我）。

那这种方案有啥缺点？我觉得是，1）有字体安装要求，比如 Mac、iOS 内置支持，Window 可能要安装字体才能工作，2）只能覆盖样式，不能覆盖 `<title>` 属性的「浏览器标题展示」，3）只是展示上用繁体，如果你复制文本粘贴到本地，那还是简体的。

4、总结下，如果是我的项目会用啥方案？方案 2。

相关示例代码我传到 github 上了，见 [https://github.com/sorrycc/chinese-convert-example](https://github.com/sorrycc/chinese-convert-example) 。

参考：  
[https://github.com/BYVoid/OpenCC](https://github.com/BYVoid/OpenCC)  
[https://www.zhangxinxu.com/wordpress/2021/01/css-simplified-traditional-chinese/](https://www.zhangxinxu.com/wordpress/2021/01/css-simplified-traditional-chinese/)
