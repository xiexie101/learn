---
title: "298 - ã€ŠNode é¡¹ç›®åˆå§‹åŒ– SOPã€‹"
date: 2023-05-10
url: https://sorrycc.com/node-boilerplate-sop
---

å‘å¸ƒäº 2023å¹´5æœˆ10æ—¥

# 298 - ã€ŠNode é¡¹ç›®åˆå§‹åŒ– SOPã€‹

å‚æ™šå‡†å¤‡å†™ä¸ªè„šæœ¬ï¼Œå®ç°ç”¨ ChatGPT å†™ä¹¦ã€‚åœ¨å¼€å§‹å†™ä»£ç ä¹‹å‰ï¼Œæ‘†åœ¨é¢å‰çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯å¦‚ä½•åˆå§‹åŒ–é¡¹ç›®ã€‚è™½ç„¶åšè¿‡ N éï¼Œä½†ç”±äºæ­¥éª¤æ¯”è¾ƒå¤šï¼Œä»å¤´æ¥ä¸€éè¿˜æ˜¯æŒºè´¹æ—¶é—´çš„ã€‚äºæ˜¯å°±æƒ³ç€æŠŠè¿™ä¸ªæ­¥éª¤ä¹Ÿ SOP åŒ–ã€‚

1ã€åˆå§‹åŒ–é¡¹ç›®ã€‚å®ŒæˆåŒ…å« TypeScriptã€Fatherã€Prettierã€ZXã€Release è„šæœ¬ç­‰çš„åˆå§‹åŒ–ä»£ç å’Œé…ç½®ã€‚å®Œæˆåå¯ä»¥ç”¨ pnpm dev å¯åŠ¨ã€pnpm build æ„å»ºã€pnpm release å‘å¸ƒç­‰ã€‚

```bash
mkdir src && touch src/index.ts
mkdir scripts
cat <<EOF >package.json
{
  "name": "myapp",
  "version": "0.0.0-alpha.0",
  "homepage": "https://github.com/sorrycc/myapp",
  "bugs": "https://github.com/sorrycc/myapp/issues",
  "repository": {
    "type": "git",
    "url": "https://github.com/sorrycc/myapp"
  },
  "license": "MIT",
  "files": [
    "bin",
    "dist"
  ],
  "scripts": {
    "build": "father build",
    "dev": "father dev",
    "doctor": "father doctor",
    "release": "father doctor && esno scripts/release.ts"
  },
  "devDependencies": {
  }
}
EOF
cat <<EOF >tsconfig.json
{
  "compilerOptions": {
    "declaration": true,
    "declarationMap": true,
    "esModuleInterop": true,
    "module": "commonjs",
    "moduleResolution": "node",
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "strict": true,
    "skipLibCheck": true,
    "target": "es2019",
    "jsx": "react",
    "paths": {
    }
  },
  "exclude": [
    "**/node_modules",
  ]
}
EOF
cat <<EOF >.prettierrc
{
  "printWidth": 80,
  "singleQuote": true,
  "trailingComma": "all",
  "proseWrap": "never",
  "overrides": [{ "files": ".prettierrc", "options": { "parser": "json" } }],
  "plugins": [
    "prettier-plugin-organize-imports",
    "prettier-plugin-packagejson"
  ]
}
EOF
cat <<EOF >.gitignore
/node_modules
/dist
EOF
cat <<EOF >.editorconfig
# ğŸ¨ http://editorconfig.org
root = true

[*]
indent_style = space
indent_size = 2
end_of_line = lf
charset = utf-8
trim_trailing_whitespace = true
insert_final_newline = true

[*.md]
trim_trailing_whitespace = false
EOF
cat <<EOF >.prettierignore
node_modules
EOF
cat <<EOF >.fatherrc.ts
import { defineConfig } from 'father';

export default defineConfig({
  cjs: {
    output: 'dist',
  },
});
EOF
cat <<EOF >README.md
# myapp
EOF
cat <<EOF >scripts/release.ts
import 'zx/globals';

(async () => {
  const branch = (await \$\`git branch --show-current\`).stdout.trim();
  await \$\`npm run doctor\`;
  await \$\`npm run build\`;
  await \$\`npm version patch\`;
  await \$\`npm publish\`;
  await \$\`git push origin \${branch} --tags\`;
})().catch((e) => {
  console.error(e);
  process.exit(1);
});
EOF
pnpm i typescript father prettier prettier-plugin-organize-imports prettier-plugin-packagejson @types/node zx -D
```

2ã€å¦‚æœéœ€è¦æ›¿æ¢é¡¹ç›®åã€‚

```bash
sed -i '' 's/myapp/chatgpt-book/g' package.json && sed -i '' 's/myapp/chatgpt-book/g' README.md
```

3ã€å¦‚æœæ˜¯ç”¨ WebStormï¼Œéœ€è¦åšä¸¤ä¸ªé…ç½®ã€‚1ï¼‰exclude distï¼Œ2ï¼‰åœ¨è®¾ç½®é‡Œé…å¥½ prettierï¼Œä¿å­˜æ—¶è‡ªåŠ¨æ ¼å¼åŒ–ã€‚

4ã€å¦‚æœéœ€è¦æ·»åŠ å‘½ä»¤è¡Œï¼ŒåŸºäº yargs-parserã€‚

```bash
mkdir bin
cat <<EOF >bin/myapp.js
#!/usr/bin/env node  
  
require('../dist/cli');
EOF
chmod +x bin/myapp.js
cat <<EOF >src/cli.ts
import yParser from 'yargs-parser';
const args = yParser(process.argv.slice(2), {});
args;
EOF
pnpm i @types/yargs-parser yargs-parser -S
```

5ã€å¦‚æœéœ€è¦æ·»åŠ ç®€å•çš„ Cache å¤„ç†ã€‚

```bash
cat <<EOF >src/cache.ts
import fs from 'fs';
import path from 'path';
import * as mkdirp from 'mkdirp';

export class Cache {
  cache: Map<string, any> = new Map();
  filePath: string;

  constructor(opts: { filePath: string }) {
    mkdirp.sync(path.dirname(opts.filePath));
    this.filePath = opts.filePath;
    const content = fs.existsSync(opts.filePath)
      ? fs.readFileSync(opts.filePath, 'utf-8')
      : \`{}\`;
    const json = JSON.parse(content);
    this.cache = new Map(Object.entries(json));
  }

  get(key: string): any {
    return this.cache.get(key);
  }

  set(key: string, value: any): void {
    this.cache.set(key, value);
    // save to file
    const json = Object.fromEntries(this.cache.entries());
    fs.writeFileSync(this.filePath, JSON.stringify(json, null, 2));
  }
}
EOF
pnpm i mkdirp -D
```

6ã€å¦‚æœéœ€è¦æ·»åŠ ç®€å•çš„ env ç¯å¢ƒè¯»å–å¤„ç†ã€‚

```bash
cat <<EOF >src/env.ts
import dotenv from 'dotenv';
import fs from 'fs';
import path from 'path';

export function getEnv() {
  const envPath = path.join(__dirname, '../.env');
  return fs.existsSync(envPath)
    ? dotenv.parse(fs.readFileSync(envPath, 'utf-8'))
    : process.env;
}
EOF
touch .env
touch .env.example
echo ".env" >> .gitignore
pnpm i dotenv -S
```
