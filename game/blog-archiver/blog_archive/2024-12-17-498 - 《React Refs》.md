---
title: "498 - ã€ŠReact Refsã€‹"
date: 2024-12-17
url: https://sorrycc.com/react-refs
---

å‘å¸ƒäº 2024å¹´12æœˆ17æ—¥

# 498 - ã€ŠReact Refsã€‹

è¶ç€ React 19 æ­£å¼å‘å¸ƒï¼Œé‡æ–°çœ‹ä¸€é Refsï¼Œåšä¸‹ç¬”è®°ã€‚

1ã€Refs æ˜¯é€ƒç”Ÿèˆ±ï¼Œå…è®¸ç”¨æˆ·å¯ä»¥ï¼Œ1ï¼‰è®¿é—® DOM èŠ‚ç‚¹ï¼Œ2ï¼‰ä¿å­˜ä¸éœ€è¦è§¦å‘ re-render çš„å€¼ã€‚æ¯”å¦‚ã€‚

1ï¼‰DOM æ“ä½œã€‚

```ts
function TextInput() {
  const ref = useRef(null);
  function handleFocus() {
    inputRef.current.focus();
  }
  return <input ref={ref} />;
}
```

2ï¼‰ä¿å­˜ä¸éœ€è¦è§¦å‘ re-render çš„å€¼ã€‚

```ts
function Timer() {
  const ref = useRef(null);
  useEffect(() => {
    ref.current = setInterval(fn, 1000);
    return () => clearInterval(ref.current);
  }, []);
}
```

2ã€Refs æœ€ä½³å®è·µã€‚

1ï¼‰ä¼˜å…ˆç”¨å£°æ˜å¼æ–¹æ¡ˆï¼Œæ¯”å¦‚ autofocus vs. ref ã€‚

```tsx
// ğŸš« é¿å…
<div ref={el => el?.focus()} />

// âœ… ä½¿ç”¨
<input autoFocus />
```

2ï¼‰ä¸è¦åœ¨æ¸²æŸ“æœŸé—´è¯»å†™ refã€‚

```tsx
function MyComponent() {
  // ğŸš« é¿å…åœ¨æ¸²æŸ“æ—¶è¯»å†™ ref
  const value = myRef.current;
  
  // âœ… åœ¨äº‹ä»¶å¤„ç†å™¨ä¸­ä½¿ç”¨
  function handleClick() {
    myRef.current.focus();
  }
}
```

3ï¼‰callback refs ä¼˜äº useRef + useCallbackã€‚

```tsx
// ğŸš«
const ref = useRef(null);
useEffect(() => {
  ref.current?.scrollIntoView({ behavior: "smooth" });
}, []);
return <input ref={ref} />;

// âœ…
const ref = useCallback((node) => {
  node?.scrollIntoView({ behavior: "smooth" });
}, []);
return <input ref={ref} />;
```

3ã€ä¸€ä¸ªæ¦‚å¿µï¼šæ‰€æœ‰ ref å±æ€§éƒ½åªæ˜¯å‡½æ•°ã€‚

```tsx
// å‰è€…æ˜¯åè€…çš„è¯­æ³•ç³–
<div ref={ref} />
<div ref={(node) => {ref.current = node}} />
```

4ã€React 19 çš„ Refs æ”¹åŠ¨ä¸»è¦æœ‰ä¸¤ä¸ªï¼Œ1ï¼‰æ”¯æŒæ¸…ç†å‡½æ•°ï¼Œ2ï¼‰Ref å¯ä»¥ä½œä¸º props ä¼ é€’ã€‚Ref æ¸…ç†å‡½æ•°çš„åœºæ™¯æ¯”å¦‚å–æ¶ˆè®¢é˜…ã€æ¸…ç†å®šæ—¶å™¨ã€æ–­å¼€è¿æ¥ã€åœæ­¢ç›‘å¬ã€é‡Šæ”¾èµ„æºç­‰ï¼Œä¸è¿‡æˆ‘è§‰å¾—ä»–å’Œ useEffect æ¸…ç†å‡½æ•°çš„åœºæ™¯ç¨å¾®æœ‰äº›å†²çªã€‚Ref ä½œä¸º props ä¼ é€’æ„å‘³ç€ forwardRef ä¸å†éœ€è¦ã€‚

```tsx
// æ—§æ–¹å¼
const MyInput = forwardRef((props, ref) => {
  return <input {...props} ref={ref} />;
});

// React 19 æ–°æ–¹å¼
function MyInput({ref, ...props}) {
  return <input ref={ref} {...props} />;
}
```

å‚è€ƒï¼š  
[Manipulating the DOM with Refs â€“ React](https://react.dev/learn/manipulating-the-dom-with-refs)  
[Referencing Values with Refs â€“ React](https://react.dev/learn/referencing-values-with-refs)  
[useRef â€“ React](https://react.dev/reference/react/useRef)  
[forwardRef â€“ React](https://react.dev/reference/react/forwardRef)  
[React v19 â€“ React](https://react.dev/blog/2024/12/05/react-19)  
[Escape Hatches â€“ React](https://react.dev/learn/escape-hatches)  
[<StrictMode> â€“ React](https://react.dev/reference/react/StrictMode)  
[React Refs: The Complete Story | Playful Programming](https://playfulprogramming.com/posts/react-refs-complete-story)  
[Implementing advanced usePrevious hook with React useRef](https://www.developerway.com/posts/implementing-advanced-use-previous-hook)  
[Refs in React: from access to DOM to imperative API](https://www.developerway.com/posts/refs-from-dom-to-api)  
[Make useRef lazy â€” 4 ways](https://thoughtspile.github.io/2021/11/30/lazy-useref/)  
[So you think you know everything about React refs](https://thoughtspile.github.io/2021/05/17/everything-about-react-refs/)  
[è¯‘ï¼šRef Callbacks, React 19 and the Compiler](https://sorrycc.com/ref-callbacks-react-19-and-the-compiler)  
[è¯‘ï¼šé¿å…ä½¿ç”¨å¸¦æœ‰ callback refs çš„ useEffect](https://sorrycc.com/avoiding-use-effect-with-callback-refs)
