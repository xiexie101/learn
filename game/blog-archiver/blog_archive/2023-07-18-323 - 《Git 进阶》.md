---
title: "323 - 《Git 进阶》"
date: 2023-07-18
url: https://sorrycc.com/git-tips-advanced
---

发布于 2023年7月18日

# 323 - 《Git 进阶》

本文内容主要来自 [《Git Hidden Gems》](https://www.youtube.com/watch?v=WtUCZYyv-_w) 这个分享。

**1、更好看的日志**

直接执行 `git log` 很丑且信息密度较低，可以改用 `git log --pretty="%C(red)%h%Creset%C(yellow)%d%Creset %s %C(cyan)(%ar)%Creset"`，效果见下图。

![](https://img.alicdn.com/imgextra/i1/O1CN01VhitIk1gpzAXZvxdZ_!!6000000004192-2-tps-1800-882.png)

同时可以加个 `lg` 的 alias，后续执行 `git lg` 即可。

```
git config --global alias.lg "log --pretty='%C(red)%h%Creset%C(yellow)%d%Creset %s %C(cyan)(%ar)%Creset'"
```

编者注：日志我个人更推荐用 [tig](https://jonas.github.io/tig/) 这个命令。

**2、更好看的 DIFF**

Git 默认 pager 是 less，可以通过设置改成 [delta](https://github.com/dandavison/delta)。

```
brew install git-delta
git config --global core.pager delta
```

效果见下图。

![](https://img.alicdn.com/imgextra/i3/O1CN01XRHw5423QYKy8sKMx_!!6000000007250-2-tps-1922-906.png)

**3、staging**

git stash 和 git stash pop 大家应该都熟。我常用的一个组合命令是 `git stash && git checkout master && git fetch && git rebase && git stash pop`，先把改动存起来，然后拉 master 最新代码 rebase，再回复本地代码改动，接着开发。

看视频学到的一点是 `git stash --keep-index`，加 `--keep-index` 可以在 stash 改动的基础上，将暂存区的改变保留在你的工作目录。

**4、搜索**

基本搜索是加 `-S` 参数，比如 `git log -S "test"`，如果基于第一条进行过设置，也可以 `git lg -S "test"`。

新学到的是 `-L` 参数，用于显示某个文件中特定函数或行范围的历史。比如下面这行可以用来显示关于文件 `src/test.ts` 中 `add` 函数的所有提交历史的。

```
git log -L:add:src/test.ts
```

**5、自动化**

比如。

```
git config --global rebase.autosquash true
git config --global rebase.autostash true
```

其中 autostash 的作用是，在 rebase 前后自动 `git stash` 和 `git stash pop`。这样，我前面说的命令 `git stash && git checkout master && git fetch && git rebase && git stash pop` 就可以简化掉前后的 stash 操作了。

**6、dot notation**

用两个点表示范围。

```
git log master..topic
git config --global alias.new 'lg master..HEAD'
git config --global alias.missing 'lg HEAD..master'
git new
git missing
```

**7、rebase onto**

新学到的知识，rebase 有 --onto 参数。比如下面这条命令会将 `master` 和 `feature` 之间的所有提交从 `master` 上剥离下来，并重新应用到 `develop` 上。

```
git rebase --onto develop master feature
```

比如下面这行命令会将 `46bfd98` 到当前分支之间的所有提交从 `46bfd98` 移动到 `main` 分支上。

```
git rebase --onto main 46bfd98
```

**8、reflog**

reflog 通常用于找丢失的记录。

**9、rerere**

全称叫「Reuse Recorded Resolution」。启用后，rerere 会记住冲突的每一方，并在下次再次出现相同冲突时应用记录的解决方案。

```
git config --global rerere.enabled true
git rerere forget src/index.ts
```

参考：  
[Git Hidden Gems - Enrico Campidoglio - NDC Oslo 2023 - YouTube](https://www.youtube.com/watch?v=WtUCZYyv-_w)  
[221 - 《Git 技巧》](https://sorrycc.com/git-tips)
