---
title: "214 - 《CSS 的问题和趋势》"
date: 2022-11-16
url: https://sorrycc.com/css-problems-and-trends
---

发布于 2022年11月16日

# 214 - 《CSS 的问题和趋势》

## 传统 CSS 有啥问题？

不展开解释了，不明白问题点的可以去看 [vjeux 的分享](https://speakerdeck.com/vjeux/react-css-in-js)，其中前 7 个都来自那里。

1、全局作用域，多页面团队协作时容易冲突  
2、无法模块化，比如 JS 依赖了哪些 CSS，CSS 被哪些 JS 依赖？  
3、无用代码无法剔除，很多人的做法是，全局搜索某个 class 是否有被使用  
4、压缩效率低，比如选择器里的 id 和 className 无法混淆压缩  
5、常量无法共享，分两个场景，CSS 文件之间的共享和 CSS 与 JS 之间的共享  
6、生效顺序依赖加载顺序，尤其是引入 code splitting 之后，这个问题就更严重了  
7、无法安全隔离，比如我们可能会用 .antd-xxxx div 去覆盖 antd 的样式，而 antd 维护者不可能把这些也考虑进去  
8、文件体积线性增长，随着项目越来越大，CSS 尺寸线性增长  
9、类型不安全

## 面向这些问题，有哪些解的方向？

1、CSS Modules  
2、CSS in JS  
3、Atom CSS  
4、Atom CSS in JS

CSS Modules 通常会搭配 less/sass 一起使用，能解问题 1、2、3 和 5。会引入一个额外的问题，「性能，less 构建慢」。

CSS in JS 比如 styled-components、emotion。这个方向能解大量问题，上面的除了 8 都能解。但是，他会引入新问题。比如额外的 runtime js（sc gzip 后 12.7K）、额外的性能开销、SSR 效率和兼容性（尤其是和 Streaming 模式兼容不好）。

Atom CSS 比如 tailwind css、windicss、unocss，能解问题 1、2、3、4、5 和 8。注意，他能解 8，据统计，Atom CSS 相比 CSS Modules 根据项目类型的不同，能减少 50%-70% 的 CSS 代码。

Atom CSS in JS 我理解是在 CSS in JS 的基础上，让 build 产物以 Atom CSS 的形式输出，结合了这两个方案的优点，能解全部问题。这个概念我是今天看到 stylex 发布 npm 包 beta 了解的，但早已不是新东西，twitter 和 meta 都在用。社区方案比如 twitter 的 react-native-web、meta 的 stylex、微软的 griffel，以及还有 style9、linaria、compiled 和 vanilla-extract + sprinkles 都属于此类，rax 也有个叫 zstyle 的方案。

Atom CSS in JS 由于要产出 Atom CSS，就必须在编译时做分析。缺点是啥？1）动态性，比如要基于 props 做样式区分的代码就不能提出来，有些方案支持有些不支持，2）不支持 code-splitting，产物通常是一个整体的 CSS 文件，3）对 CSS 属性简写、mediaquery、伪类的支持也要考虑，这里我还没细看，但感觉肯定有解。

## 怎么选？

不想折腾想躺平的选 CSS Modules，因为和传统 CSS 的心智最契合；没有性能和 SSR 需求的比如中后台选 CSS in JS（推荐 Emotion），方案成熟，该趟的坑都有前人趟过；有性能需求的对 C 应用可以尝试 Atom CSS in JS，我觉得这是未来，但距离成熟还有很多路要走，现阶段可以先用 griffel 试试水或者等 stylex 开源。

## 参考

[https://speakerdeck.com/vjeux/react-css-in-js](https://speakerdeck.com/vjeux/react-css-in-js)  
[https://sebastienlorber.com/atomic-css-in-js](https://sebastienlorber.com/atomic-css-in-js)  
[https://juejin.cn/post/7166058054092324894](https://juejin.cn/post/7166058054092324894)  
[https://compiledcssinjs.com/docs/atomic-css](https://compiledcssinjs.com/docs/atomic-css)  
[https://andrejgajdos.com/css-modules-vs-css-in-js-vs-atomic-css-in-react-js/](https://andrejgajdos.com/css-modules-vs-css-in-js-vs-atomic-css-in-react-js/)  
[https://frontendmastery.com/posts/the-evolution-of-scalable-css/](https://frontendmastery.com/posts/the-evolution-of-scalable-css/)  
[https://github.com/necolas/react-native-web](https://github.com/necolas/react-native-web)  
[https://stylex-docusaurus-nmn.vercel.app/](https://stylex-docusaurus-nmn.vercel.app/)  
[https://griffel.js.org/](https://griffel.js.org/)  
[https://yuque.antfin.com/es2049/wl24q5/mh8zv5](https://yuque.antfin.com/es2049/wl24q5/mh8zv5)  
[https://yuque.antfin.com/rax/qvvyvu/dulsow](https://yuque.antfin.com/rax/qvvyvu/dulsow)
