---
title: "499 - 《React 国际化方案》"
date: 2024-12-19
url: https://sorrycc.com/react-i18n
---

发布于 2024年12月19日

# 499 - 《React 国际化方案》

前几天看群里有同学在问，正好 tnf 也需要一套国际化方案，做了下调研。

1、现在 Umi 的国际化方案。基于 [react-intl](https://github.com/formatjs/formatjs/tree/main/packages/react-intl)，按需加载 [intl](https://github.com/andyearnshaw/Intl.js) 作为补丁。react-intl 由 Yahoo 研发。是 Format.js 生态的一部分。

先在 locales 里定义语言，可以用 .ts 也可以用 .json 。

```ts
// src/locales/zh-CN.ts
export default {
  welcome: '欢迎光临 Umi 的世界！',
};
```

然后使用时用 FormattedMessage 渲染。

```ts
import { FormattedMessage } from 'umi';
<FormattedMessage id="welcome" />
```

也可以拿到 intl 然后去 formatMessage。不推荐，它脱离了 React 的生命周期，可能导致切换语言时无法触发 DOM 的 re-render 。

```ts
import { useIntl } from 'umi';
const intl = useIntl();
intl.formatMessage({ id: 'welcome' });
```

支持动态插值，比如 `Hello {name}`，`<FormattedMessage id="welcome" values={{name: 'fooo'}} />`。

支持切换。

```ts
import { setLocale } from 'umi';
setLocale('en-US');
// 切换但不刷新
setLocale('en-US', false);
// 切换到默认语言
setLocale();
```

支持通过配置实现路由 title 的国际化。

2、[react-i18next](https://github.com/i18next/react-i18next)，基于 [i18next](https://github.com/i18next/i18next)。周下载 300W+，是 react-intl 的 2-3 倍。

相比 react-intl，react-i18next 的优点是：

1）生态好，大型应用用 react-i18next 更合适  
2）国际化文件支持按需加载，性能上会更好  
3）SSR 友好  
4）TypeScript 支持友好（？）  
5）通过 [Trans 组件](https://react.i18next.com/latest/trans-component)支持复杂的 JSX 内容翻译（句子翻译）

先初始化 i18n 。（注：http backend 通常可以搭配 [localstorage-backend](https://github.com/i18next/i18next-localstorage-backend) 做缓存）

```ts
import i18n from 'i18next';
import Backend from 'i18next-http-backend';
import LanguageDetector from 'i18next-browser-languagedetector';
i18n
  // 异步加载国际化数据
  .use(Backend)
  .use(LanguageDetector)
  .use(initReactI18next)
  // options: https://www.i18next.com/overview/configuration-options & https://react.i18next.com/latest/i18next-instance
  .init({});
```

在 public/locales/zh/translation.json 中定义。

```json
{
  "welcome": "欢迎来到 TNF ！",
  "getting-started": "编辑 <1>src/App.zh-CN.js</1> 快速开始。"
}
```

然后通过 useTranslation 使用（class 可以用 withTranslation hoc）。

```tsx
import { useTranslation } from 'react-i18next';
const { t, i18n } = useTranslation();
t('welcome')
```

也可以用 Trans 组件翻译整段 jsx。

```tsx
import { Trans } from 'react-i18next';
<Trans i18nKey="getting-started">
  To get started, edit <code>src/App.js</code> and save to reload.
</Trans>
```

加 TypeScript 类型。

```ts
import "i18next";
import translation from "locales/en/translation.json";
declare module "i18next" {
  interface CustomTypeOptions {
    resources: {
      translation: typeof translation;
    }
  }
}
```

参考：  
[Umi - 国际化](https://umijs.org/docs/max/i18n)  
[Drawbacks of other i18n solutions | react-i18next documentation](https://react.i18next.com/guides/the-drawbacks-of-other-i18n-solutions)  
[TypeScript | i18next documentation](https://www.i18next.com/overview/typescript)  
[Introduction | i18next documentation](https://www.i18next.com/)  
[react-i18next/example/react at master · i18next/react-i18next · GitHub](https://github.com/i18next/react-i18next/blob/master/example/react)  
[How to internationalize a Remix application (Part 1)](https://locize.com/blog/remix-i18n/)
