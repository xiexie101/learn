---
title: "380 - 《用 Rust 写一个 SSG 的 Blog》"
date: 2023-02-28
url: https://sorrycc.com/ssg-blog-with-rust
---

发布于 2023年12月4日

# 380 - 《用 Rust 写一个 SSG 的 Blog》

> 本文是 [https://github.com/bahlo/arne.me](https://github.com/bahlo/arne.me) 的源码阅读笔记和想法。这是一个很好的 Rust 入门项目。

1、一个题外话，简单的应用并不需要复杂的框架。今天翻到一篇年初的文章 [https://begin.com/blog/posts/2023-02-28-redefining-developer-experience](https://begin.com/blog/posts/2023-02-28-redefining-developer-experience) ，大家对 SPA、框架、DX 都颇有微词，觉得前端技术迭代后，提升了 DX，但损失了 UX。举个例子，比如引入了 React，虽然写代码更统一、方便和快了，但对最终用户来说，确实是增加了尺寸，访问时需要加载的资源增加了，对 UX 是一种倒退。

2、回到这个主题，Blog 需要 JavaScript 和框架吗？可能并不需要。[mdhweekly.com](http://mdhweekly.com) 加载时需要下载近 200K（Gziped + Minified）的 JavaScript 用户才能看到结果。所以一个简单的 Blog 只要一个整体布局 + 一些样式 + SSG 的内容即可，不需要 React，甚至不需要 JavaScript。

3、[arne.me](http://arne.me) 如他写的文章 [https://arne.me/articles/write-your-own-ssg](https://arne.me/articles/write-your-own-ssg) 里所描述，基于 Rust 实现。其实这个场景用 Rust 相比 JavaScript 没啥优势，依赖库少，写起来复杂，也没利用到 Rust 语言快的优势。我理解主要是验证 Rust 的可行性以及纯粹是作者个人的喜好吧。

4、依赖库方面。渲染相关，用 [comrak](https://crates.io/crates/comrak) 解析 Markdown（支持 Github Flavored 语法），用 [gray\_matter](https://crates.io/crates/gray_matter) 解析 frontmatter，用 [maud](https://maud.lambda.xyz/) 作为 Html 模版，用 [grass](https://crates.io/crates/grass) 做 SCSS 编译，用 [rss](https://crates.io/crates/rss) 生成 RSS，用 [quick-xml](https://crates.io/crates/quick-xml) 生成 Site Map。其他，用 notify-debouncer-mini 做 watch，用 file-serve 做静态文件 Server，用 scraper 解析 HTML（支持 CSS Selector Query），用 chrono 作为日期库，用 blake3 计算 Hash，用 clap 作为命令行解析库。

5、实现上可以从入口文件 [main.rs](http://main.rs) 开始看，用 Clap 定义命令，包括 Build、Watch、DownloadFonts 等。

6、Build 做的事是这些。1）解析 content 目录下的内容，其中 Content 结构体包含所有内容相关的数据，2）用 grass 编译 SASS 为 CSS，并用 blake3 算个 hash 避免缓存问题，3）生成首页、文章页、Pages 页等，4）生成 RSS 和 SiteMap。

7、Watch 是在 Build 的基础上增加了监听和 HMR 功能。这里会涉及一点点异步编程的概念。作者通过线程的方式组织，一共 3 个线程：build、reload 和 websocket。build 线程在 watch 到文件变更时会重新执行 cargo run build，完成后用 crossbeam\_channel 发消息给 build\_tx；reload 线程监听 build\_rx，build 完成后会通过 socket 发消息 reload 给客户端；websocket 线程会启一个 websocket server，然后处理 websocket 连接池。

8、话说回来，如果改用 JavaScript 实现这一套，应该会更简单，比如由于 Node 的特性，都不需要考虑线程问题。

参考：  
[GitHub - bahlo/arne.me: My personal website](https://github.com/bahlo/arne.me)  
[Why You Should Write Your Own Static Site Generator](https://arne.me/articles/write-your-own-ssg)
