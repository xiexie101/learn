---
title: "147 - 《bun》"
date: 2022-07-06
url: https://sorrycc.com/what-is-bun
---

发布于 2022年7月7日

# 147 - 《bun》

[https://bun.sh/](https://bun.sh/)

作者是 [Jarred](https://twitter.com/jarredsumner)，加州，高中辍学，曾在 Stripe 和 Thiel Fellowship 工作，目前应该是全职做 Bun。

Bun 的官方定义是「Bun is a fast all-in-one JavaScript runtime」。Fast、All-in-one 和 JavaScript Runtime。

JavaScript Runtime 现在主流的比如 node 和 deno，以及 JavaScript + WASM 的 Serverless 平台，他们都基于 V8，遵循 [WinterCG 规范](https://wintercg.org/)。而 Bun 是基于 Apple 的 [JavaScript Core](https://developer.apple.com/documentation/javascriptcore)。然后像 fs、network、eventloop 等 runtime 能力，也没有基于 C++/Rust，而是用了 Zig。

All in one。感觉定位和 deno 有点像，很多 node 生态的东西，全部内置集成。首先是 bun xxx.ts 可直接运行，就像 node 一样。然后还有很多子命令。包括 install、add、remove 用于类 npm 的依赖管理；create 用于创建项目；run 用于类 npm run 的任务管理；dev 用于启动 server；bun 用于打包；wiptest 用于测试。最后 Bun 集成了很多之前由生态提供的能力，让开发者可以开箱即用，比如 TypeScript 和 JSX 支持，.env 支持，fetch、WebSocket、ReadableStream 等 Web API、SQLite 支持等。

快。个人使用下来，add、run、dev、bun、wiptest 这些命令，都能明显感受到快。bun run 这个命令我个人已完全代替 pnpm run 和 npm run，已用数月。然后官方给的数据，serve 和 sqlite 和 ffi 等方面，相比 node 和 deno，也都有数量级层的提升。早上验证了下各包管理器的速度，安装我本地从未安装过的 antd@5，为了「公平」，让 npm 先跑，结果是「bun > pnpm > npm > yarn」，安装尺寸也没问题，见图。

![](https://img.alicdn.com/imgextra/i3/O1CN01PFpHqn1wyGEsfAOTr_!!6000000006376-0-tps-2112-502.jpg)

bun bun 是做打包，产物格式是 .bun 的单文件，文档中说目前的格式可能会调整。这个打包和传统意义的不太一样，其实可以叫「依赖打包」，有点类似 umi 的 mfsu 打包依赖。比如 `bun bun ./src/index.tsx`，会从 `./src/index.tsx` 开始递归找依赖，把所有非项目文件依赖打包到 node\_modules.bun 文件中。

bun dev 是启动服务器。bun dev 是秒启动，为啥？1）和 vite 一样，是 esm bundless 的，请求过来才会 transform 文件，也支持各种 assets 资源的处理，2）bun create 项目时会运行一遍 bun bun ./src/index.tsx，做依赖的预编译，所以请求时也会更快。至于为啥要做 bun bun，官方给的答案是，1）浏览器侧尽管有 modulepreload 话题 HTTP/3，但都不如 bundle 速度快，2）服务器端，bundle 可以减少 IO。

bun 基于 Zig，而 Zig 设计的初衷就是和 C 无缝对接「designed from the ground up with C interop as a first class feature」，他的 FFI 消耗非常低，和 C/C++ 一样，参考 [https://github.com/dyu/ffi-overhead](https://github.com/dyu/ffi-overhead) 。这让 Bun 调用 C++ 写的 JavaScriptCore 引擎非常快。所以这应该也是 Bun 为啥快的原因之一。

参考：  
[https://bun.sh/](https://bun.sh/)  
[https://github.com/Jarred-Sumner/bun](https://github.com/Jarred-Sumner/bun)  
[https://linux-china.davao.page/blog/2022-07-06-bunjs-intro/](https://linux-china.davao.page/blog/2022-07-06-bunjs-intro/)  
[https://linux-china.davao.page/blog/2022-07-07-js-runtime/](https://linux-china.davao.page/blog/2022-07-07-js-runtime/)
