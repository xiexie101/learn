---
title: "168 - 《手撕源码 24：SolidStart》"
date: 2022-08-15
url: https://sorrycc.com/source-24-solidstart
---

发布于 2022年8月15日

# 168 - 《手撕源码 24：SolidStart》

[https://github.com/solidjs/solid-start](https://github.com/solidjs/solid-start)

SolidStart 是基于 Solid 的元框架，提供约定式路由、SSR、CSR、SSG、API 路由、Code Splitting、Dead Code 消除、内置 Fetch 等 Web 标准方法、CSS Modules、TypeScript、SASS、部署平台适配器等功能支持。

提供 dev、build、start 和 use 4 个命令。dev、build 和 start 应该都非常熟悉，每个框架都有类似的。use 倒是第一次看到，use 即「use a solid-start feature」，用于额外增加一个功能，目前支持 mdx、playwright、tailwind 和vitest，和 umi g 功能类似，但感觉用 use 更能表达出这个意思。

构建基于 vite 实现，SolidStart 在此基础上增加了 600+ 行的插件。功能包含配置解析、文件系统路由、islands 插件、inspect 插件、vite-plugin-solid 插件、自定义 dev handler 中间件、等。islands 插件用于将 ?island 结尾的模块挂载到 `window._$HY` 上，同时支持 `island(() => import(""))` 的使用语法。

再看项目组织方式，src 目录下通常会有 components、routes、entry-client.tsx、entry-server.tsx、root.tsx，这和 remix 很像。这种方式相比 umi 更白盒一些。比如 client 侧的引用路径是，entry-client.tsx（项目） > StartClient（框架） > root.tsx（项目） > Routes（框架）> FileRoutes（框架）> routes（项目）。

SolidStart 里有提取 Adapter，用于适配不同 runtime 和平台，比如 node、deno、vercel、netlify、cloudflare、static 等。每个 Adapter 需要提供两个方法，start() 和 build()，分别在 start 和 build 命令里调用，build 命令里会传 builder 进去，提供 client、server、spaClient、islandsClient 等构建函数，供 Adapter 按需使用。

Islands 的实现感觉还不全，examples 里都搜不到 islands。先构建一遍拿 route manifest，其中以 ?island 结尾的 key 即 islands，然后再构建一遍，入口文件除了 client-entry，还包含所有 islands。

在 SolidStart 里看到了 Outlet、Route Action、Route Data，以及他们的入口定义和扩展方式都和 Remix 很像，这像地也有点太多了，怪不得 Remix 团队说他们抄袭。
