---
title: "471 - 《用 Cursor 开发一个命令行工具》"
date: 2024-10-12
url: https://sorrycc.com/cli-with-cursor
---

发布于 2024年10月12日

# 471 - 《用 Cursor 开发一个命令行工具》

> 介绍 Cursor 的一次实践，昨天学习了 Cursor，正好有个命令行工具的开发需求，就拿它来练手了。

1、初始化目录。

```bash
$ mkdir picture-manager
$ cd picture-manager
$ cursor .
```

2、写需求。

内容如下，保存到 plan.txt 文件里。

```
我要用 Node 写一个 Cli 工具，他包含 2 部分。

1、一个图床 server。
基于 express 框架，默认端口 8000，通过环境变量 PORT 指定端口，提供一些 API 如下。
1）POST /api/pictures/upload 通过 API 可以上传图片，图片上传后通过 uuid 生成文件名，图片会存储在服务器的 /data/pictures 目录里，并返回图片的 url，数据保存在 /data/pictures.json 文件里（以 uuid 为 key），包含图片的 url、名称、尺寸、上传时间、对应 xxx 服务器上的路径（默认为空）。
2）GET /api/pictures/no/xxx 通过 API 可获取所有没有 xxx 服务器上路径的图片数据，返回数组。
3）PUT /api/pictures/:id 传入 { xxxUrl: 'xxx' } 更新指定图片的 xxx 服务器上路径，同时更新 /data/pictures.json 文件，返回更新后的图片数据，失败返回错误信息。
4）GET /api/pictures/:id 获取指定图片的数据，返回图片数据，失败返回错误信息。
此外，
1）通过 http 服务提供图片的访问，图片的 url 为 /p/:uuid，图片存储在 /data/pictures 目录里。同时记录访问日志，记录访问时间、来源 IP 地址、访问的图片 url，记录到 /data/access.log 文件里。
2）POST 和 PUT API 支持跨域，允许所有来源。
3）POST 和 PUT API 需要 TOKEN 认证，通过环境变量 API_TOKEN 指定。

2、一个 xxx url 替换工具。
分几个步骤。
1）查询图床 server（图床 server 的地址通过 --server 指定），获取没有 xxx 服务器上路径的图片数据。
2）对每一张图片，调用 xxx 的 API 上传图片，获取 xxx 上的图片 url。
3）调用图床 server 的 API 更新图片的 xxx 服务器上路径。
此外，
1）支持通过 --watch 参数实时监控图床 server 上的图片，发现有新的图片时自动上传图片并更新图床 server 上的路径，每 10 秒查询一次，通过参数 --interval 调整查询间隔。
```

3、创建脚手架。

⌘+⇧+I 调出 Cursor Composer，输入 `use the instructions in @plan.txt to create the app`，点「accept all」。

4、验证。

安装依赖并启动服务。

```bash
$ pnpm i
$ pnpm run start
```

开一个新的 Terminal 验证图片上传功能。

```bash
$ API_TOKEN=your_secret_api_token_here node ./src/cli/index.js --server http://localhost:8000 --file /path/to/a.jpg
```

5、修复错误。

我遇到一个错误。

```
Error uploading file: Data after transformation must be a string, an ArrayBuffer, a Buffer, or a Stream
```

尝试用 Cursor 来解这个问题，在打开对应文件 `src/cli/index.js` 时，⌘+I 调出 Cursor Composer，输入 `fix the error`，点「accept all」。

6、重新尝试上传图片。

成功了！

```bash
File uploaded successfully: {
  id: '4b83ced9-6c7b-472a-9b50-703a7799430c',
  url: '/p/4b83ced9-6c7b-472a-9b50-703a7799430c.gif',
  name: 'stage_lines-compressed.gif',
  size: 371148,
  uploadTime: '2024-10-12T07:25:51.302Z',
  xxxUrl: ''
}
```

⌘+I 调出 Cursor Composer，输入 `添加一个功能，如果传入 --file 和 --server 时，把文件传到目前实现的图床 server 里。`，点「accept all」。

7、做一些细微调整，可以选中代码后按 ⌘+K，然后输入指令调整。

![](https://tcc.sorrycc.com/p/682c9153-b54e-436b-919e-78c410ec5489.png)

8、其他，一些 Tips。

1）用 Cursor Composer 大改之前记得用 Git 保存代码。  
2）让 AI 写代码，有种别样的乐趣，像是请了一个高级助手，感觉很奇妙。但是，太过于借助 AI，可能会让自己对编码的掌握变弱。  
3）感觉很多初级程序员会失业，一些初级编程任务，自己写完需求基本就等于完成了，比交代别人去做还要快。。 4）需求文档存仓库，在 AI 时代，需求文档才是核心。不要临时写，因为后续可能会因为某些原因要重新来一遍。

参考：  
[470 - 《Cursor 体验》](https://sorrycc.com/cursor)
