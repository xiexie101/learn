---
title: "382 - 《Umi 5》"
date: 2023-12-08
url: https://sorrycc.com/umi-5
---

发布于 2023年12月8日

# 382 - 《Umi 5》

上午周会时大家一起脑暴了下 Umi 5 / Bigfish 5，做下记录。

1、时间预计是明年开始做研发。

2、兼容！兼容！兼容！会兼容现有 95% 以上的功能，剩下 5% 做明确提示或 Code Mod 工具，让所有 Umi 4 用户能够无痛升级。当然，有些冷门功能会删掉，比如 SWC 的构建器。在此之前，需要梳理大量 e2e 用例来复现现有的场景、插件、API 和配置等。

3、构建工具删除 Vite、Esbuild，保留 Webpack 和 Mako，同时切换默认工具为 Mako。

4、Rust 含量 🔼 🔼 🔼。除了构建工具，框架还是不少地方是可以用 Rust 来提速的，比如现在 Umi prepare 阶段分析 App Data 的过程，现在用的是 esbuild，优点割裂，同时能获取的信息有限，基于 Mako（Rust）则是想要啥拿啥。比如 SSR 的 serverLoader、SPA 的 ClientLoader、Icons 等方案，都有跑一些微构建，可以换成 Mako（Rust）。比如 Config 的解析和读取也可以用。比如作为 Webpack 的压缩器。同时，Umi 5 应该会用编译后的 Mako，而不是直接使用 Mako，因为会有不少定制功能和需求。

5、RSC 和 SSR。这里还没完全考虑清楚，但对于有性能追求的业务来说，SSR 应该是绕不过去的，而 RSC 可以让 SSR 的性能更进一步。同时 RSC 这种编码方式应该是未来的方向。

6、组装式。见 [213 - 《如果我重新设计 Umi 01：组装式》](https://sorrycc.com/if-redesign-umi-01) 。Umi 提供路由、App + Title + Meta 等组件、App Data 元信息、构建 + 测试 + Lint + Dev + SSR + SSG + RSC 能力等。用户基于此可以做组装。组装可用于项目，也可用于框架。

7、路由运行时方案自研。抛弃 React Router 了，原因包括 1）是 React Router 新版设计不是我们想要的，2）是 Umi 3 升 4 的大部分 Break Change 其实和路由有关，不敢跟了。所以会做路由能力的自研，和数据方案深度整合，同时基于 6，路由运行时方案也可组装。另外，会有新的约定式路由规则，应该是 Remix 和 Next.js 的结合体，取长补短，见 \[\[译：Next.js 13 与 Remix：深入案例研究\]\] 。

8、编译时错误处理。之前看到一句话，套到 Umi 里也同样合适，「如果一件事，Umi 觉得你不能做，会通过编译器错误阻止你，而不是任由编译通过，然后让程序在运行过程中听天由命，让你无休止地和捉摸不定的并发 bug 斗争。」其实是把内部的 Doctor 规则和强约束规则开源，同时做地更多更细，就像在 Rust 里写代码写得不好编译器会直接告诉你一样。

9、其他脑暴点包括。1）新的最佳实践插件集，2）和 AI 的整合，3）等。

参考：  
[189 - 《如果我再写一遍 Umi 4》](https://sorrycc.com/if-rewrite-umi-4)  
[213 - 《如果我重新设计 Umi 01：组装式》](https://sorrycc.com/if-redesign-umi-01)
