---
title: "212 - 《Umi 最佳实践：Icons 使用》"
date: 2022-11-11
url: https://sorrycc.com/umi-best-practise-icons
---

发布于 2022年11月11日

# 212 - 《Umi 最佳实践：Icons 使用》

> 计划近期每周更新 1 篇 Bigfish 2022 版的最佳实践，这是第 6 篇。

## 问题

你是不是觉得使用 Icons 非常简单？在项目里存 svg 文件，然后 import 过来使用就可以？这能有啥问题？

```ts
import IconUrl, { ReactComponent as IconComponent } from './icon.svg';
```

1、以上是 Umi/Bigfish 内置支持的作为 url 和 react component 两种方式。但如果不加约束，用法会千奇百怪。@依鹭 同学[两年前就整理过](https://yuque.antfin.com/bigfish/best_afs/lzoifi)，光统计到的就有 7 类 11 种用法，可能会被用作 DOM、图片、CSS 背景、字体等等。怎么选？当时有做过最佳实践，但在 Bigfish 4 时先下了，因为有想到更好的方案。

2、昨天有整理一篇[《你不知道的 9 个 @ant-design/icons 使用问题》](https://yuque.antfin.com/yunqian/write/ppcroo)，虽然官方只推荐了一种，但在实际使用中却有很多人不遵守，[在 code.alipay.com 上搜一下](https://code.alipay.com/search?query=@ant-design/icons/)就会发现有数千条非入口的引用方式。大家没有从入口引我觉得初心是好的，希望多写点代码也要手动减少产物大小，但结果除了让代码不一致，还会导致产物变大、重复、构建变慢、类型不安全、单测不兼容等问题。

3、svg 你会用外链（单独的请求）还是内联（inline base 64）？标准答案是以 10K 为界，小于的内联，大于的外链。这是 Umi/Bigfish 的内置配置，但这真是标准答案吗？外链可能会导致闪烁，而内联则有几个你可能不知道的问题。1）当以 base 64 用于 CSS 背景属性时，写几个就会重复几个，造成产物尺寸增加，因为 CSS 没有变量的概念（或者有但目前出于兼容考虑不会用），2）缓存随着 JS 走，容易失效，不像外链一样有单独的 url 单独的缓存，3）会增加 JS 的尺寸，有一份额外的 JS 代码解析消耗。

4、使用 Icon 时通常还会做一些属性调整，比如基础的 size、viewBox、fill、style，以及进阶的 spin、rotate、twoToneColor。Ant Design Icons 有提供封装，但使用本地的 Icon 或其他 Icon 集时，并不是每个地方都有提供封装的，如何做、如何保证开发体验的一致性、如何保证类型安全、如何保证不引入没有用到的 Icon 库？

5、其他和 Icons 相关的问题我想到的还有，比如。1）如何引入 [iconfont.cn](http://iconfont.cn) 上的远程 icon，2）如何引入 iconify.design 上的 icon 集，比如 font awesome、bootstrap，3）如何在组件里使用 Icons，4）如何定义新的 icon 集，5）本地 icons 如何存放和组织，等。

## 新方案

我想这里需要解的是「编译性能、产物尺寸、开发体验」这些方面的问题。

解法分几部分，1）通过编译时能力确保产物只包含使用到的部分，按需生成 ICON 定义集，2）新增统一的 Icon 组件处理，用相同的方式调用本地 Icon、ant-design-icon 以及其他的 Icon 集，提供统一 svg 属性覆盖和高级功能属性，并确保类型安全（TypeScript Safe）。

## 最佳实践

> 此功能还在研发中，预计一周后发布。

Umi/Bigfish 层提供 Icon 组件。

```ts
import { Icon } from 'umi';
```

使用 ant-design-icons 或其他 icon 集合。

```ts
<Icon name="ant-design:ant-cloud-outlined" />
<Icon name="logos:webpack" />
<Icon name="fa:apple" />
```

自定义属性。

```ts
<Icon
  name="ant-design:ant-cloud-outlined"
  fill="" stroke="" viewBox=""
  rotate={} spin={} style={}
/>
```

使用本地 Icons。

```ts
// 需要先有 src/icons/foo.svg
<Icon name="foo" />
```

通过 icons 配置修改全局样式。

```ts
export default {
  icons: { styles: { verticalAlign: 'middle' } }
}
```

参考：  
[https://react-svgr.com/](https://react-svgr.com/)  
[https://github.com/antfu/unplugin-icons](https://github.com/antfu/unplugin-icons)  
[https://github.com/natemoo-re/astro-icon](https://github.com/natemoo-re/astro-icon)  
[https://github.com/nuxt-modules/icon](https://github.com/nuxt-modules/icon)  
[https://github.com/unocss/unocss/tree/main/packages/preset-icons](https://github.com/unocss/unocss/tree/main/packages/preset-icons)  
[https://iconify.design/](https://iconify.design/)  
[https://icones.js.org/](https://icones.js.org/)  
[https://yuque.antfin.com/bigfish/doc/use-icon](https://yuque.antfin.com/bigfish/doc/use-icon)  
[https://github.com/ant-design/ant-design-icons](https://github.com/ant-design/ant-design-icons)  
[https://unpkg.alibaba-inc.com/browse/@iconify/json/](https://unpkg.alibaba-inc.com/browse/@iconify/json/)  
[https://unpkg.alibaba-inc.com/browse/@iconify/json-tools/](https://unpkg.alibaba-inc.com/browse/@iconify/json-tools/)  
[https://yuque.antfin.com/forces/mobile-app/dny68m](https://yuque.antfin.com/forces/mobile-app/dny68m)  
[https://yuque.antfin.com/bigfish/best\_afs/lzoifi](https://yuque.antfin.com/bigfish/best_afs/lzoifi)
