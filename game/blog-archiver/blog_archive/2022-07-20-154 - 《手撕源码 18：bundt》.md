---
title: "154 - 《手撕源码 18：bundt》"
date: 2022-07-20
url: https://sorrycc.com/source-18-bundt
---

发布于 2022年7月20日

# 154 - 《手撕源码 18：bundt》

bundt 是一个模块打包工具，官方定义是「A simple bundler for your delicious modules~!」，主打简单。翻他的源码主要是好奇，因为第一眼看到时翻了下 package.json，发现除了 terser 居然没有任何打包相关的库，他是怎么实现的 bundler ？

作者是 Luke Edwards，来自 CA 的小伙，之前在 Cloudflare。他和 sindresorhus 有点像，写了很多很 mini 的库，其中 tsm 和 taskr 之前都有用过。

bundt 尝鲜步骤如下。

```bash
$ echo '{"name":"foo"}' > package.json
$ pnpm i bundt -D
$ mkdir src && echo 'export default () => "foo"' > src/index.js
$ npx bundt

Filename      Filesize (gzip)
dist/foo.js      38 B  57 B
```

执行完之后会在 dist 目录生成 foo.js，内容为 `module.exports = () => "foo"` 。

功能上支持 esm、cjs、umd，支持压缩，支持 d.ts，不支持 TypeScript。用户用 esm 的方式编写源码，然后 bundt 会帮你产出 cjs、esm、umd 等格式的产物。

bundt 如何产出 cjs？基于作者写的另一个库 rewrite-imports（和 moduloze 刚好实现互转），负责将 `import { foo } from 'foo'` 转化成 `const { foo } = require('foo')`，然后替换 `export default` 为 `module.export`，以及把 `export xxx` 转换为 `exports.xxx`。

bundt 如何产出 esm？直接复制源码到 dist 目录。

bundt 如何产出 umd？在 cjs 产物的基础上，额外加上 UMD 的 wrapper 代码，区分是否为 default 导出，默认用 package.json 中声明的 name 为全局变量名。

参考：  
[https://github.com/lukeed/bundt](https://github.com/lukeed/bundt)
