---
title: "220 - 《CSS 方案 2022》"
date: 2022-11-25
url: https://sorrycc.com/css-2022
---

发布于 2022年11月25日

# 220 - 《CSS 方案 2022》

> 梳理下我的 CSS 方案的理解，同时给正在准备的 《最佳实践 2022-7：CSS 方案》做下铺垫。

1、传统 CSS 有很多问题，vjeux 2014 年的分享[《React: CSS in JS》](https://speakerdeck.com/vjeux/react-css-in-js)就有过介绍。包括全局作用域、无法模块化、无用代码无法剔除、压缩效率低、常量无法共享、生效顺序依赖加载顺序、无法安全隔离等。除此之外，还有另外 2 个他没有提到的问题，1）文件体积线性增长，2）类型不安全。

2、面对这些问题，社区的解分 4 个大方向。1）CSS Modules，2）CSS in JS，3）Atom CSS，4）Atom CSS in JS。但是要注意，有些方向在解问题的同时，也带来了新的问题。比如 CSS Modules + Less 带来的编译速度问题，CSS in JS 带来的运行时性能问题。

![](https://img.alicdn.com/imgextra/i3/O1CN01SKLsjK1tYCkW5G8iF_!!6000000005913-0-tps-1283-608.jpg)

3、CSS Modules 通常会搭配预编译语言（比如 Less/Sass）一起使用。我们目前的方案就是 Less + CSS Modules。比传统 CSS 好了很多，但最让我不能忍的是编译速度问题，比如 Vite + Less 的模式下其他都是个位数毫秒返回而 [Less 则需要 2s 一个](https://juejin.cn/post/7162082035513688071)。Webpack 模式下大型项目（比如 yuyanAssets）在编译时 Less 也是占了其中很大的比重。而且这个问题看不到未来解的可能，因为处于 ROI 考虑，没人会愿意用 Rust 重写一个 Less。 ![](https://img.alicdn.com/imgextra/i1/O1CN01UUGe3Q1KPxAmOwTU9_!!6000000001157-2-tps-3070-1864.png) ![](https://image-1256177414.cos.ap-shanghai.myqcloud.com/picgo/20221125162558.png)

4、传统 CSS in JS 主要是 [styled-components](https://github.com/styled-components/styled-components) 和 [emotion](https://github.com/emotion-js/emotion) 这两个用地最广的。就像 vjeux 分享的，CSS in JS 能解大部分传统 CSS 的问题。但也引入的新的问题，1）运行时性能问题，2）和 SSR 的兼容问题，3）对于初级开发者来说的上手成本问题，4）[基于 cssom 的插入优化和 qiankun 的冲突问题](https://blog.csdn.net/qq_21567385/article/details/122656654)，等等。同时传统 CSS in JS 不能解「文件体积线性增长」的问题。这些问题给社区很多发挥的空间。

5、你可能已经发现，上一段的措辞里加了「传统」，就是因为还有不少新一代各有「特色」的 CSS in JS 方案。他们能是 CSS in JS 的增强，为不同的问题而生。比如 [Vanilla Extract](https://vanilla-extract.style/)、[Linaria](https://github.com/callstack/linaria) 等，他们通过编译时提取样式，以解运行时性能问题；另外还有一类能解「文件体积线性增长」问题的有个统一的名字叫「Atom CSS in JS」，这在稍后再展开介绍。

6、先说 Atom CSS。这类中最突出的是大名鼎鼎的 [Tailwind CSS](https://tailwindcss.com/)，此外还有 [WindiCSS](https://windicss.org/) 和 [UnoCSS](https://github.com/unocss/unocss)。除了使用起来 DX（开发者体验） 好之外，还有个突出的优点是能解「文件体积线性增长」，据不权威统计，Atom CSS 相比 CSS Modules 产出的文件能减少 50%-70%。个人理解 Tailwind 适用于做对 C 的短平快的网站，因为他内置的设计元素好看又好用，但对于企业类型的并不适合，因为企业级网站通常有自己的设计元素，而要基于 Tailwind 做定制并不是件容易的事。而要做定制版的 Atom CSS 方案，用 UnoCSS 或 Vanilla Extract + Sprinkles 可能是更好的选择。

7、再回到 [Atom CSS in JS](https://sebastienlorber.com/atomic-css-in-js)。我理解是 CSS in JS 和 Atom CSS 的结合体，在 CSS in JS 的基础上，让 build 产物以 Atom CSS 的形式输出。大家在 Twitter 首页打开 Devtool 的 Element 面板，看到的大量不是人写的 className 就是 Atom CSS in JS 的「功劳」。这一领域的方案比如 Twitter 的 [react-native-web](https://github.com/necolas/react-native-web)、Meta 的 [stylex](https://stylex-docusaurus-nmn.vercel.app/blog/) 和微软的 [griffel](https://griffel.js.org/)。缺点是目前还不成熟，社区应用较少，Meta 的 stylex 也还没开源。 ![](https://img.alicdn.com/imgextra/i2/O1CN01BNx0aL1wPS8dTLnYG_!!6000000006300-2-tps-2180-1070.png) ![](https://image-1256177414.cos.ap-shanghai.myqcloud.com/picgo/20221125170021.png) ![](https://img.alicdn.com/imgextra/i3/O1CN01zWDztY1gJvVYecMn7_!!6000000004122-2-tps-1845-408.png) ![](https://image-1256177414.cos.ap-shanghai.myqcloud.com/picgo/20221125170321.png)

8、所以 Bigfish 应该怎么选？其实 LESS + CSS Modules 也能用。但如果多往前看点，我们可能并不希望两年后还用着被社区淘汰的 LESS，届时 LESS 可能会成为编译速度上的唯一卡点。结合我们的现状（中台、antd 5 已无不需要 less、大量合作伙伴、…），Tailwind 肯定不适用，定制 Atom CSS 倒可能是一条路但成本略高，Atom CSS in JS 太靠前，本着负责任的态度不应该引入风险太高的技术栈，CSS in JS 又有性能问题且上手成本略高。所以，我们的选择是…「计划在下周的《Bigfish 最佳实践 2022-7：CSS 方案》中揭晓」。

参考：  
[https://frontendmastery.com/posts/the-evolution-of-scalable-css/](https://frontendmastery.com/posts/the-evolution-of-scalable-css/)  
[https://andrejgajdos.com/css-modules-vs-css-in-js-vs-atomic-css-in-react-js/](https://andrejgajdos.com/css-modules-vs-css-in-js-vs-atomic-css-in-react-js/)  
[https://juejin.cn/post/7166058054092324894](https://juejin.cn/post/7166058054092324894)  
[https://www.yuque.com/ningzbruc/future/uvxx6l](https://www.yuque.com/ningzbruc/future/uvxx6l)  
[https://yuque.antfin.com/es2049/wl24q5/mh8zv5](https://yuque.antfin.com/es2049/wl24q5/mh8zv5)  
[https://yuque.antfin.com/rax/qvvyvu/dulsow](https://yuque.antfin.com/rax/qvvyvu/dulsow)
