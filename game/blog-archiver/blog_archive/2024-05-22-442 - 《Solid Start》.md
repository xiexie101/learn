---
title: "442 - 《Solid Start》"
date: 2024-05-22
url: https://sorrycc.com/solid-start
---

发布于 2024年5月22日

# 442 - 《Solid Start》

> 看到 [译：SolidStart 1.0：未来框架的形态](https://sorrycc.com/solid-start-the-shape-frameworks-to-come) 1.0 版正式发布和开源，简单翻了下文档和源码。

1、快速上手，可以访问 [https://start.solid.new/](https://start.solid.new/) 或者运行下方命令。

```bash
# 记得选 Solid Start
pnpm create solid
```

2、用户侧设计。

```bash
+ src
  + components
  + lib
  + routes
  - app.tsx
  - entry-client.tsx
  - entry-server.tsx
- app.config.ts
- package.json
```

用户项目的主要目录如上。

*   package.json 中的 dev、build、start 都是调 vinxi，而不是 solid start 之类的命令，还是第一次看到不自己封一下的框架
*   app.config.ts，给 vinxi 的配置，内容为 `import { defineConfig } from "@solidjs/start/config"; export default defineConfig({});`
*   src/app.tsx，主入口组件，`import { FileRoutes } from "@solidjs/start/router"` 后用 `<FileRoutes />` 来渲染路由
*   src/entry-client.tsx，客户端入口，`import { mount, StartClient } from "@solidjs/start/client"` 后 `mount(() => <StartClient />, el)` 来渲染
*   src/entry-server.tsx，服务端入口，`import { createHandler, StartServer } from "@solidjs/start/server"` 后 `export default createHandler(() => (<StartServer />))` 来处理服务端请求

这种组装式的设计，把主动权完全交给用户，从入口文件到路由都是可以定制的，和我期望的 Umi 5 的样子有点像了。

3、框架实现。

![](https://res.cloudinary.com/sorrycc/image/upload/v1716367426/blog/2nogai4e.png)

1）整体基于 [Seroval](https://github.com/lxsmnsyc/seroval)、[Vinxi](https://github.com/nksaraf/vinxi) 和 Solid Router。Seroval 做数据的序列化；Vinxi 我第一次见，他基于 Vite 和 Nitro，提供给你搭建框架所需的常见 SDK，比如路由、服务端处理、RSC、SSR、SPA 等，基于此我们可以快速搭建一个新的框架；Solid Router 是 Solid 的官方路由方案。

2）我们在 packages/start/config/index.js 里能看到整体的配置情况，总共会做 3 份构建，client、ssr 和 server-fns。

3）路由基于 `vinxi/fs-router` 实现，在其基础上支持了 `[]`、`()` 和 `…` 等规则。

4）server function 基于 `@vinxi/server-functions` 实现，支持在 client 组件里加 `"use server"` 在服务端执行（TODO：这里的实现有时间再展开看下）。比如。

```ts
export const getUser = cache(async (id: string): Promise<UserDefinition> => {
  "use server";
  return fetchAPI(`user/${id}`);
}, "user");
```

有了 Vinxi，基于 Vite 搭建一个新的框架好简单，可惜我们不用 Vite。

4、其他。

1）有看到一些 refresh pragma，比如 `// @refresh skip` 和 `// @refresh reload` 等，第一次看到，显式指定 refresh 的行为，盲猜是 Vite 的功能？

参考：  
[https://github.com/nksaraf/vinxi](https://github.com/nksaraf/vinxi)  
[https://github.com/solidjs/solid-start](https://github.com/solidjs/solid-start)  
[https://www.solidjs.com/blog/solid-start-the-shape-frameworks-to-come](https://www.solidjs.com/blog/solid-start-the-shape-frameworks-to-come)  
[https://start.solidjs.com/](https://start.solidjs.com/)
