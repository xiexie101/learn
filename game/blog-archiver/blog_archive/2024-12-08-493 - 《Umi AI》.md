---
title: "493 - 《Umi AI》"
date: 2024-12-08
url: https://sorrycc.com/umi-ai
---

发布于 2024年12月8日

# 493 - 《Umi AI》

1、之前写了 [488 - 《前端 x AI》](https://sorrycc.com/frontend-ai)，准备给 tnf 加上 AI 的能力，但一直没着手做。直到上周看到 [cali](https://github.com/callstackincubator/cali) ，仿照着写了 [@umijs/ai](https://github.com/umijs/ai) 。

2、@umiji/ai 是一个通用解，通过 prompt + function call + tools 的公式来解问题，tools 提供针对性问题的准确解，比如 install packages、fs 等。

![](https://tcc.sorrycc.com/p/83d61850-f165-4a01-a372-479e90f70852.gif)

3、实现方式是基于 ai npm 包的 generateText，while true 循环调，直到任务结束后退出。参考 [https://github.com/umijs/ai/blob/master/src/cli.ts#L52](https://github.com/umijs/ai/blob/master/src/cli.ts#L52)

```ts
const openai = createOpenAI({
  apiKey: OPENAI_API_KEY,
});

const messages = [];
while (true) {
  const response = await generateText({
    model, system, tools, messages,
  });
}
```

4、和 cali 的区别就是提供的 prompt 和 tools 不同。@umijs/ai 提供前端相关的最佳实践。比如最佳实践部分如下。所以 @umijs/ai 可以理解为一个解前端问题的 Agent。

```
BEST PRACTICES:
- Use TypeScript.
- Use Prettier for formatting. Perferred config: printWidth: 80, singleQuote: true, trailingComma: all, proseWrap: never, importOrderSortSpecifiers: true, use @trivago/prettier-plugin-sort-imports to sort imports.
- Perferred style: indent_style: space, indent_width: 2.
- How to add father as component bunder.
  1. add father as dev dependency
  2. add .fatherrc.ts, content: import { defineConfig } from 'father'; export default defineConfig({ cjs: { transformer: 'babel', input: 'src', output: 'dist' } });
  3. add "build": "father doctor && father build" to scripts in package.json
- How to add commitlint to enforce commit message convention.
  1. This depends on husky, so make sure husky is installed.
  2. add @commitlint/cli and @commitlint/config-conventional as dev dependency
  3. add .commitlintrc.js, content: module.exports = { extends: ['@commitlint/config-conventional'] };
  4. Create .husky/commit-msg file, content: npx --no -- commitlint --edit $1
- How to add lint-staged to format files on commit.
  1. add lint-staged as dev dependency
  2. add "lint-staged": { "*.{js,jsx,ts,tsx}": ["prettier --write"] } to package.json
- Do not use specifiers for \`fs\` and \`path\` modules.
- Do use \`test()\` instead of \`describe() + it()\` for test cases.
- Keep a log of what, why and how you did what you did in "fyi.md". Keep it updated.
- Make sure the created files are ending with a new line at the end of the file.
```

5、如何把 @umijs/ai 集成到 tnf 里使用？我理解 tnf ai = @umijs/ai + tnf tools + tnf best practices + project description。

6、tools 和最近 claude 出的 MCP 协议其实很像，把 tools 包一层做成 MCP Server，就可以在 claude 或其他 MCP Client 里使用了，所以我们看 cali 的最新版，其实已经可以在 claude 里使用。

参考：  
[https://github.com/umijs/ai](https://github.com/umijs/ai)  
[https://github.com/callstackincubator/cali](https://github.com/callstackincubator/cali)  
[520 - 《Cursor 和 MCP》](https://sorrycc.com/cursor-and-mcp)
