---
title: "189 - 《如果我再写一遍 Umi 4》"
date: 2022-09-21
url: https://sorrycc.com/if-rewrite-umi-4
---

发布于 2022年9月21日

# 189 - 《如果我再写一遍 Umi 4》

刚好昨天有人问，今天就借机复盘下 Umi 4 大版本的开发。

1、专注度。

我觉得 Umi 4 做了不少非必要和锦上添花的功能。究其原因是 Umi 本身的定位其实没那么清晰，这是个大而全的框架，Slogon 也是「企业级前端开发框架」，啥都能做，啥都要做。平时对前端趋势追的快，看到好的就想着应用在 Umi 里会怎样，于是试验下，越加越多，哈哈。

从蚂蚁的业务出发，我们回顾下 Umi 4 的功能。很多功能都是非必要的，包括 SSR、多构建引擎、Vue 支持、API 路由、Auto Import 等。很多功能是锦上添花的，包括自动 https、浏览器里的构建进度条、Terminal 里的日志、产物调试、deadCode 检测等。真正需要的功能并不多，比如 Umi Max、最快的 CSR 请求、MFSU V3、某些依赖更新（不包括 React Router 6）、Lint 方案等。

知道「不做什么」很重要，那怎么决定哪些事 Umi 不应该做？可能要进一步明确 Umi 的定位。如果 Umi 的定位是 CSR 框架，那 SSR、API 路由肯定就不会做。如果定位是 React 框架，那 Vue 支持就不会做。等等。如果定位是 SPA，那就不会去支持 MPA。

2、Break Change。

Umi 4 我是推翻重写的，引入了不少现在看来不必要的 Break Change。感觉也是给自己挖了个坑，现在做应用治理（升级 3 到 4）需要额外费不少力气。

大的 Break Change 主要 3 点，1）路由，2）history，3）请求，其他基本都可通过配置变更的方式覆盖。跟着 react-router 升级感觉走偏了，react-router 作者和我一样，想法很多，比如 3-4 是大变更，社区反应了好久，6.3 到 6.4 也是大变更，Umi 已跟不动。history 主要是是否有 query 这个变更引起的，也和 react-router 相关。请求我改成了 axios。

3、如果我重写一遍 Umi 4。

先明确定位，改成「基于 React 的插件化的企业级 CSR SPA 框架」。这样就知道应该「不做什么」了。只做 React。只做 SPA。只做 CSR，和社区其他框架做差异化，把 CSR 的体验做到极致，国内和国外环境不同，大量场景其实用不上 SSR。做企业级相关的功能，企业级和其他开源项目其实差异挺大的，面向企业的框架会更多考虑这些点，1）稳定性，2）安全性，3）最佳实践。

锦上添花的功能砍一半，留一半相对更有用的。

功能做少了，那省出来大量人力怎么办？持续打磨 MFSU、最佳实践、文档、社区等。

极少 Break Change 化，升级只需做配置层的变更，新功能配置开启，老功能不直接废弃，而是加 deprecate 提醒，等 Umi 5 时再删。不升 React Router 6 不改 history，改成自研，兼容已有用法。请求方案通过配置开启，老方案依旧可用，只是使用时有个 deprecate 警告。

4、我有很多其他想法怎么办？

憋着！或者，另外写个框架，哈哈。

参考：  
[https://zhuanlan.zhihu.com/p/531657498](https://zhuanlan.zhihu.com/p/531657498)
