---
title: "101 - 《Umi 如何支持 Vue》"
date: 2022-04-21
url: https://sorrycc.com/umi-support-vue
---

发布于 2022年4月21日

# 101 - 《Umi 如何支持 Vue》

Umi 在 4.0.0-rc.13 中提供了 Vue 支持，记得我在 Umi 2 时画过一张架构图，其中就有 Vue 的一环，Umi 3 时也有过尝试，但那会 Vue 3 还不太成熟，接入时遇到不少坑，这个坑今天总算是补上了。此功能由社区同学（应该也在这个星球）操刀，这里做下记录。

Umi 提供了路由、构建、插件、配置等能力，这些能力是通用的。现在社区的元框架比如 next、nuxt、remix、astro、sveltekit 虽然细节不同，但也基本都是这些元素。所以，既然是通用的，为何不能同时支持多个框架呢？

其实可以的，Umi 从架构上就支持任意上层运行库的集成。Umi 通过编译时生成 templates（临时文件），包含路由（或者理解为页面）、运行时插件、其他辅助信息等；然后把他们传递给 renderer 渲染，renderer 目前内置了 renderer-react 和 renderer-vue，后续还会支持其他；最后 templates 和 renderer 都会交由 bundler 构建为产物。

Framework = template + renderer + bundler。

renderer：renderer-react | renderer-vue | renderer-mpa | renderer-svelte | …  
template：pages + runtime plugin + …  
bundler：bundler-webpack | bundler-vite | bundler-esbuild | bundler-esmi | …

所以，Umi 要支持 Vue，主要是做三件事。

1、renderer 层提供 vue 的渲染器。renderer 需要导出 renderClient 和 renderServer 方法。前者做 CSR 渲染，接口要求如下；后者是可选的，做 SSR 渲染。

```ts
export function renderClient(opts: {  
 rootElement?: HTMLElement; // 根节点，决定渲染到哪  
 routes; // 路由数据，决定渲染什么  
 pluginManager; // Umi 的运行时插件，方便扩展  
 …  
})
```

2、template 中使用 1 中提供的渲染器。Umi 有提供插件 API 用于修改渲染器地址。

```ts
api.modifyRendererPath(() => 新的 renderer 包路径)
```

3、bundler 层支持相关语法和文件。webpack 或 vite 层需支持vue 后缀文件的编译，以及其他配套编译配置。

参考：  
[https://github.com/umijs/umi-next/releases/tag/v4.0.0-rc.13](https://github.com/umijs/umi-next/releases/tag/v4.0.0-rc.13)
