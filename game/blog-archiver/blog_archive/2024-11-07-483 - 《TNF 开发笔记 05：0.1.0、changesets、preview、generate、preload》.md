---
title: "483 - 《TNF 开发笔记 05：0.1.0、changesets、preview、generate、preload》"
date: 2024-11-07
url: https://sorrycc.com/tnf-05
---

发布于 2024年11月7日

# 483 - 《TNF 开发笔记 05：0.1.0、changesets、preview、generate、preload》

1、0.1.0 发布。

今天（2024.11.07）上午在完成了 [Roadmap](https://github.com/umijs/tnf/issues/2) 中 0.1.0 的功能后，发布了 0.1.0。目前功能已经初具雏形，如果你有新的 SPA 项目想找个框架尝鲜，建议试试 TNF，已经可以用起来了。包含 route、build、dev、create、preview、generate、config 等。

如果你想上手，可以这么操作。

```bash
$ pnpx @umijs/tnf create myapp --template=simple
$ cd myapp
$ pnpm i
```

然后可以用 `tnf generate` 生成页面。

```bash
$ npx tnf generate page foo
```

然后可以本地 dev 或 build，build 之后可以用 preview 在本地预览效果。

```bash
$ pnpm dev
$ pnpm build
$ pnpm preview
```

![](https://tcc.sorrycc.com/p/bc326f61-887d-44f2-af9a-d427c4004daf.gif)

2、changesets 社区用的很广，不过我还是第一次[在自己 owner 的项目里用](https://github.com/umijs/tnf/pull/10)，详见恨晚。

changesets 的使用分三步，1）提 pr 或 commit 时执行 npx changeset 在 .changeset 目录生成 changelog，2）每个 PR 合并之后会自动[提一个 PR](https://github.com/umijs/tnf/pull/13)（如果有 PR 会更新 PR），3）发布之前合并 PR 更新 changelog 到 master。

注：changesets 也可以自动做发布，参考 [https://github.com/changesets/action?tab=readme-ov-file#with-publishing](https://github.com/changesets/action?tab=readme-ov-file#with-publishing) 。

3、preview 是在本地预览构建产物的功能。通常是 build 完成后执行 preview 来验证 build 产物的功能是否正常，也可以用于开一个 server 给开发或测试调试使用。除了产物用 build 之外，其他一切功能和 dev server 保持一致，包括 mock、proxy、middleware 等。

4、generate 用于快速代码。

由于这套路由所需的脚手架代码（暂时）偏多了一点点，所以加 generate 必不可少，我自己都不愿意每次新增路由写那么多代码，所以就有了 `tnf g page xxx` 的功能。

我一直觉得，好用的 generate 是一个框架的灵魂。同时我也觉得 generate 是和 ai 很好的协作点，最近用 cursor 有点多，我有点想把 cursor composer 的能力集成到 generate 里。比如 `tnf g ai "add prettier to project"`，比如 `tnf g ai --instrument plans/add-dev-command.txt`。

5、preload 是影响性能的关键因素之一。TanStack Router 内置了路由级的 preload 功能，以下是 preload=“intent” 基于意图做 preload 的能力演示，当用户 mouseover 或 touchstart 时，会做目标路由 loader 的 preload，然后当用户点过去之后，就可以秒开了。

![](https://tcc.sorrycc.com/p/bed8bed4-7781-4540-9b9d-513bdcc463cc.gif)

基于 TNF 使用这功能有两种方式，

1）全局开，在 .tnfrc.ts 里配置 router.defaultPreload 即可。

```ts
export default {
  router: { defaultPreload: 'indent' },
}
```

2）按需开，在 Link 里加 preload 属性即可。

```tsx
<Link preload="intent" />
```

注：这个 preload 的功能其实还是不够的，目前只 preload 了 load 的请求，但还缺 chunk 的部分（即对应路由的 css 和 js）。@tanstack/router-generator 有个 experimental.enableCodeSplitting 的配置，应该是与此有关，但需要和 bundler 搭配使用，目前还没用起来。

参考：  
[https://github.com/changesets/action](https://github.com/changesets/action)  
[https://github.com/umijs/tnf/pull/10](https://github.com/umijs/tnf/pull/10)  
[MDH Weekly 123 - 《AI 程序员》](https://sorrycc.com/mdh-123)

* * *
