---
title: "461 - 《云谦月报 2024.07》"
date: 2024-08-02
url: https://sorrycc.com/monthly-2024-07
---

发布于 2024年8月2日

# 461 - 《云谦月报 2024.07》

## 工作

> 个人部分。

1、Mako。1）截止 2024.08.02，Mako 在三条鱼的落地情况是，Bigfish 370 个，Smallfish 9 个、Minifish 16 个，2）我在 Mako 的工作包括做上个月开源的收尾、推广、Bugfix、Feature 开发和 PR 处理，Mako 钉群改用对外群，吸收了包括得物、浩鲸、快手在内的一些新同学加入，Feature 包括 publicPath 相关、emitDecoratorMetadata、Umi 透传 mako 配置等，3）为提升 Mako 的稳定性，新增了 mako checker，随机挑项目做 Mako 发布前的卡点校验，避免低级问题被发布上线，4）去爱橙做了 Mako 分享。

2、Bigfish。1）强约束迭代，由于 Mako 的接入，损失了部分 AST 层校验的能力，同时之前的方案只能和 Bigfish 一起跑，不能独立跑，所以写了个 [RFC](https://yuque.antfin.com/bigfish/rfcs/vz3v0ekebf5o2dnm) 来解这两个问题，2）Bigfish Changelog 之前不包含下游 Umi 的变更，大家看着可能会一头雾水，目前已包含。

3、Smallfish。1）开始陆续熟悉 Smallfish 代码，从日常开发和答疑开始，并且学习了下 DI，2）上手时发现本地研发在我和辟起机器上都不是很顺利，做了下工程化改造，[用 pnpm + father 代替 tnpm + nx + rollup + tsc + swc 做本地研发](https://code.alipay.com/smallfish/smallfish/pull_requests/884)。

4、Father。1）借着 Smallfish 的机会，支持了 [dev 加 `--incremental` 参数只做增量](https://github.com/umijs/father/pull/768)，因为大项目本地先跑一次 build 再 watch 还是挺慢的，同时由于是持续的开发，那一次 build 其实没有必要，2）提了两个 feature request，[dts 异步生成](https://github.com/umijs/father/issues/769)和[isolatedDeclarations 支持](https://github.com/umijs/father/issues/770)，对于本地研发的速度提升会有所帮助，尤其是后者，会是指数级的提升。

## 想法

1、Mako 关于下半年做什么团队内有做过一个[脑暴](https://yuque.antfin.com/mako/vz2gn4/uq8ql5gzxfpxk0ko)。这里记录下我的想法，重要度不分先后。1）插件体系，Mako 我理解已基本能满足我们的内部需求，而外部同学在尝试接入时，多少会因为他们的定制需求（之前基于 babel 或 webpack 插件）而遇到卡点，插件体系是让 Mako 走出去非常重要的一环（当然，我们内部也需要），实现思路是[做 unplugin 的兼容](https://github.com/umijs/mako/issues/1238)，然后利用其生态，这也是大部分新生构建工具的思路，2）功能完备性，路遥遥… 构建领域包含了太多东西，太多 edge case，以及还需要兼容现有生态（babel、webpack、npm packages、…），靠自己补肯定补不完，思路是借助 1），让生态起来，然后慢慢补，3）稳定性，我想到的是包含了功能的稳定性和性能的稳定性，解的问题 PR merge 或版本发布后性能劣化或者功能失常的问题，目前想的思路是 build 和 runtime 的真实项目校验卡点、多维度（项目、函数等）benchmark 的 CI 等，4）持续的开源影响力，比如通过文章、分享、直播、视频等形式做，持续地做，5）技术先进性，我觉得主要体现在两块，速度和产物性能，现在在 benchmark 上还是领先的，但真实项目是多维的，我们在一些大项目上的表现还是不够好，另外，6）业务落地。

2、推荐几篇我整理的译文。

*   [译：PPR – 预渲染新时代的到来与 SSR & SSG 争论的终结](https://sorrycc.com/nextjs-partial-pre-rendering/)，这是我看过把 PPR 讲地最清楚的一篇文章，我看懂了，你应该也能懂。
*   [译：PPR 是岛屿架构吗？](https://sorrycc.com/ppr-vs-islands-architecture/)，看完上一篇后再看这篇，可以把岛屿架构和 PPR 的区别搞搞清楚。
*   [译：加速 JavaScript 生态系统 – Isolated Declarations](https://sorrycc.com/speeding-up-javascript-ecosystem-part-10/)，npm 打包是很难的事，难到需要阅读十几篇博客才能了解全，Isolated Declarations 将改变这一现状，让 TypeScript 之外的工具也能轻松生成 d.ts 文件，而如果 d.ts 的生成足够快，那就不需要在发布到 npm 时生成，而可以选择在安装时生成，这将简化 npm 打包、发布、声明的流程。

3、如何让别人接受大 PR 是门艺术，大 PR 在 Review 时会有压力，所以 Reviewer 通常会拖延，需要找到大段时间再慢慢看，而如果这个 PR 的优先级没那么高，就会一直拖。所以，提大 PR 的同学如果需求迫切，其实可以调整下方法，比如，1）拆小了提，2）尽量少改动少 DIFF，3）补充用例和文档，4）详细描述背景和修改方法，5）通过一些方式让对方觉得这个改动不会造成对已有代码的影响。等等。

4、聊清楚了下半年的规划，对我来说还是很有挑战的，具体就不展开了。

## 个人

1、这个月，哈哈，完全不务正业，周末基本不挨家。。\[\[魔术\]\]、音乐、[459 - 《粤语》](https://sorrycc.com/cantonese)、户外、银河（今天晚上去）、钓鱼、\[\[调酒\]\]、看牙、摄影，应该还有啥。

2、抖音直播了一次，其实感觉应该持续做的，但是偷懒了。。

3、看了 5 本书，1）[460 - 《读书笔记：你想活出怎样的人生》](https://sorrycc.com/book-what-kind-of-life-do-you-want-to-live)，2）[454 - 《读书笔记：最优解人生》](https://sorrycc.com/book-die-with-zero)，3）旅行的艺术，4）变形记，5）我在北京送快递。

4、由于经常在外，不想看酒店的阉割版电视盒子，就买了 Chromecast with GoogleTV（店家配置过的版本，省心点）。然后在奈非小铺买了个奈非账号。

5、小册目前依旧是 0 进度。我 TM …
