---
title: "163 - 《手撕源码 22：changelogen》"
date: 2022-08-05
url: https://sorrycc.com/source-22-changelogen
---

发布于 2022年8月5日

# 163 - 《手撕源码 22：changelogen》

[https://github.com/unjs/changelogen](https://github.com/unjs/changelogen)

背景有两个。1）希望通过调研 changelog 相关库，准备给 father 加上 changelog 的能力，2）让 umi 的 changelog 工作半自动化，目前是用的 github 在线的 changelog 生成功能，需要手动做翻译、排序、过滤操作。

changelogen 应该是最近新出的，属于 unjs 下的包，这个 org 下的包通常都是简单易懂。解 changelog 生成的问题，提供 cli 和 api 两种使用方式。

使用方式是直接执行比如「npx changelogen@latest --from=v3.0.0 --to=HEAD」，支持 --from 和 --to 参数，–from 默认是上一个 git tag，–to 默认是 HEAD。

实现方式很简单，分 4 步。1）读取配置，2）获取从 from 到 to 的 commit 列表，3）解析 commit 信息，4）生成 markdown。前 3 步拿到拿到完整的 commit 元信息，如果默认 markdown 不满足需求，可以基于 API 的方式适用，拿到元信息后排序、过滤和生成符合要求的 markdown。

下面是实现中用到的一些 git 命令。

1、获取 commit 信息列表

```bash
git --no-pager log v0.1.1…HEAD --pretty="----%n%s|%h|%an|%ae%n%b" --name-status
```

2、获取 tag 列表并以时间排序，然后取最后一个即是上一个 git tag

```bash
git --no-pager tag -l --sort=taggerdate
```

3、获取当然分支

```bash
git rev-parse --abbrev-ref HEAD
```
