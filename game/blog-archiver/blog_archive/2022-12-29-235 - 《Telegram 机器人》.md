---
title: "235 - 《Telegram 机器人》"
date: 2022-12-29
url: https://sorrycc.com/telegrm-bot
---

发布于 2022年12月29日

# 235 - 《Telegram 机器人》

昨晚手痒写了个可以[自动捞前端资讯的 F2E News](https://t.me/yqtalk/67)，想着把捞到的数据做 RSS 输出。RSS 输出可以是启个 server 做，也可以把数据发到 Telegram 频道，而 Telegram 频道通过 RSSHub 可以支持 RSS。于是就在 ChatGPT 的帮助下开始研究 Telegram 机器人，比想象中简单。

## 如何申请机器人？

1、Telegram 里搜 Botfather  
2、输入 `/newbot` 创建机器人，name 必须以 bot 为结尾  
3、保存 TOKEN

## 如何让机器人发消息？

机器人可以发消息给人，也可以给频道，给频道需要把机器人以 Admin 的身份加到频道。

1、给机器人发消息，或者在频道里发消息  
2、访问 [https://api.telegram.org/bot{TOKEN}/getUpdates](https://api.telegram.org/bot%7BTOKEN%7D/getUpdates) ，拿到 chat\_id  
3、访问 [https://api.telegram.org/bot{TOKEN}/sendMessage?chat\_id={CHAT\_ID}&text=Hello World](https://api.telegram.org/bot%7BTOKEN%7D/sendMessage?chat_id=%7BCHAT_ID%7D&text=Hello%20World) ，即可发送「Hello World」

一些注意点，

1、机器人可以发送富文本，支持 html 和 markdown 两种格式，但是是有限的富文本，比如 html，仅支持很少部分标签，比如访问 [https://api.telegram.org/bot{TOKEN}/sendMessage?chat\_id={CHAT\_ID}&text=<b>Hello<%2Fb> World&parse\_mode=html](https://api.telegram.org/bot%7BTOKEN%7D/sendMessage?chat_id=%7BCHAT_ID%7D&text=%3Cb%3EHello%3C%2Fb%3E%20World&parse_mode=html) 即可让 Hello 加粗  
2、发图片可以用 sendPhoto 方法，比如 [https://api.telegram.org/bot{TOKEN}/sendPhoto?chat\_id={CHAT\_ID}&photo=https://image-1256177414.cos.ap-shanghai.myqcloud.com/uPic/sorrycc\_A\_visual\_representation\_of\_lots\_of\_blogs\_002f150a-d8ca-4be6-84.png&caption=Hello World](https://api.telegram.org/bot%7BTOKEN%7D/sendPhoto?chat_id=%7BCHAT_ID%7D&photo=https://image-1256177414.cos.ap-shanghai.myqcloud.com/uPic/sorrycc_A_visual_representation_of_lots_of_blogs_002f150a-d8ca-4be6-84.png&caption=Hello%20World)  
3、更多格式和方法可以访问[官网文档](https://core.telegram.org/bots/api)

## 如何让机器人支持自动回复？

比如支持 ChatGPT。

1、先通过 API 设置 webhook，比如访问 [https://api.telegram.org/bot{TOKEN}/setWebhook?url={URL}](https://api.telegram.org/bot%7BTOKEN%7D/setWebhook?url=%7BURL%7D)  
2、再用 Node 实现一个 webhook，示例如下

```ts
const app = express();
app.use(bodyParser.json());

app.post('/webhook', (req, res) => {
  const update = req.body;
  if (update.message) {
    const chatId = update.message.chat.id;
    const text = 'Thank you for your message!';
    axios.get(`https://api.telegram.org/bot{TOKEN}/sendMessage?chat_id=${chatId}&text=${encodeURIComponent(text)}`);
  }
  res.sendStatus(200);
});
```

参考：  
[How to create a Telegram Bot and use it to post in Telegram channels | Welcome to the Help Page!](https://help.nethunt.com/en/articles/6467726-how-to-create-a-telegram-bot-and-use-it-to-post-in-telegram-channels)  
[Telegram Bot API](https://core.telegram.org/bots/api)
