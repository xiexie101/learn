---
title: "247 - ã€ŠZod ç¬”è®°ã€‹"
date: 2023-01-16
url: https://sorrycc.com/zod
---

å‘å¸ƒäº 2023å¹´1æœˆ16æ—¥

# 247 - ã€ŠZod ç¬”è®°ã€‹

å…è´£å£°æ˜ï¼šçœ‹å®Œè¿™ç¯‡æ–‡ç« åï¼Œä½ å¯èƒ½ä¸æƒ³å†ä½¿ç”¨ä»»ä½•å…¶ä»–çš„æ ¡éªŒåº“äº†ï¼

æœ‰äººç§° Zod ä¸ºã€Œç»§ TypeScript ä¹‹åæœ€ä¼Ÿå¤§çš„åº“ã€ï¼ˆå¿˜è®°æ¥æºäº†ï¼‰ã€‚åŒæ—¶æœ€è¿‘å¥½å¤šæ–‡ç« éƒ½æåˆ°è¿™ä¸ªåº“ï¼Œäºæ˜¯ä»Šå¤©ç¿»äº†ä¸‹æ–‡æ¡£å’Œç›¸å…³æ–‡ç« ã€‚

## Zod æ˜¯å•¥ï¼Ÿ

Zod çš„å®˜æ–¹å®šä¹‰æ˜¯ã€ŒTypeScript-first schema validation with static type inferenceã€ï¼Œç¿»è¯‘è¿‡æ¥æ˜¯ã€Œä»¥é™æ€ç±»å‹æ¨ç†ä¸ºåŸºç¡€çš„ TypeScript ä¼˜å…ˆçš„ Schema æ ¡éªŒåº“ã€ã€‚ä»–åªæœ‰ 8kbï¼ˆminified + zippedï¼‰ã€‚

ç®€å•ç¤ºä¾‹ï¼Œ

```ts
// å®šä¹‰ schema
const schema = z.string();
// ç”Ÿæˆç±»å‹
type ISchema = z.infer<typeof schema>;
// æ ¡éªŒ
schema.parse('abc');
```

## ä¸ºå•¥éœ€è¦ Zodï¼ŸZod å¯ä»¥ç”¨æ¥è§£ä»€ä¹ˆé—®é¢˜ï¼Ÿ

ä»å‰é¢çš„å®šä¹‰çœ‹ï¼ŒZod åŒæ—¶åŒ…å«ä¸¤ä¸ªåŠŸèƒ½ï¼Œ1ï¼‰é™æ€ç±»å‹ï¼Œ2ï¼‰Schema æ ¡éªŒã€‚è¿™æ˜¯ä¹‹å‰çš„å¤§éƒ¨åˆ†æ–¹æ¡ˆæ‰€ä¸å…·å¤‡çš„ï¼Œæ¯”å¦‚ Joiã€Ajv ç­‰ï¼Œä»–ä»¬åªæœ‰ schema æ ¡éªŒåŠŸèƒ½ï¼Œä½†å¦‚æœä½ éœ€è¦ç±»å‹ï¼Œåˆ™éœ€è¦é¢å¤–å®šä¹‰ä¸€ä»½ TypeScript ç±»å‹ï¼Œè¿™ä¼šæœ‰å¤§é‡é‡å¤ã€‚

æ¯”å¦‚ Umi ç›®å‰çš„é…ç½®æ ¡éªŒç”¨çš„ Joiï¼ŒåŒæ—¶ä¸ºäº†è®©ç”¨æˆ·å†™é…ç½®æ—¶èƒ½æœ‰ç±»å‹æ ¡éªŒï¼Œæ˜¯é€šè¿‡ joi2types è¿™ä¸ªåº“æŠŠ Joi å®šä¹‰çš„ schema è§£ææˆé™æ€ç±»å‹ç”Ÿæˆåˆ°ä¸´æ—¶æ–‡ä»¶é‡Œå®ç°çš„ã€‚

## Zod å¯ä»¥ç”¨åœ¨å“ªï¼Ÿ

å½“ä½ åŒæ—¶å¸Œæœ›æ‹¥æœ‰é™æ€ç±»å‹å’Œ Schema æ ¡éªŒåŠŸèƒ½æ—¶å°±å¯ä»¥ç”¨ï¼Œç±»å‹æ˜¯ç°ä»£é¡¹ç›®çš„æ ‡é…ï¼Œä¹Ÿå°±æ˜¯è¯´æœ‰ Schema æ ¡éªŒåœºæ™¯çš„ï¼Œå°±éƒ½å¯ä»¥ç”¨ Zodã€‚

1ã€Umi çš„é…ç½®æ ¡éªŒï¼Œæˆ‘å‡†å¤‡åœ¨ Umi Lite é‡Œæ¢ zod  
2ã€è¡¨å•é‡Œæ ¡éªŒç”¨æˆ·è¾“å…¥  
3ã€æ ¡éªŒ URL è¾“å…¥  
4ã€æ ¡éªŒ API è¿”å›ï¼ˆå’Œ react-query æ˜¯ç»é…ï¼‰

æ¯”å¦‚åœºæ™¯ 4 å’Œ react-query çš„ç»“åˆå¦‚ä¸‹ï¼Œæ— éœ€å®šä¹‰ç±»å‹å³å¯æ‹¥æœ‰ç±»å‹ï¼ŒåŒæ—¶å¯ä»¥æ ¡éªŒåç«¯æ¥å£çš„è¿”å›ï¼Œå½“ç„¶ä¹Ÿæœ‰ç¼ºç‚¹ï¼Œ1ï¼‰è§£ææœ‰å¼€é”€ï¼Œ2ï¼‰ç”Ÿäº§ç¯å¢ƒä¸‹ç”¨è¦è°¨æ…ï¼Œå¯èƒ½å¯¼è‡´ä¸å¿…è¦çš„æŠ¥é”™ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥é’ˆå¯¹ç”Ÿäº§æ¢æˆ `z.infer()` åªæ¨å¯¼ç±»å‹ã€‚

```ts
import { z } from 'zod';
const todoSchema = z.object({ id: z.number(), text: z.string() });
const fetchTodo = async (id: number) => {
  const res = await axiod('/api/todos/${id}');
  return todoSchema.parse(res.data);
}
const todoQuery = useQuery({
  queryKey: ['todos', id],
  queryFn: () => fetchTodo(id),
});
```

å‚è€ƒï¼š  
[Zod: The Next Biggest thing after Typescript - DEV Community ğŸ‘©â€ğŸ’»ğŸ‘¨â€ğŸ’»](https://dev.to/jareechang/zod-the-next-biggest-thing-after-typescript-4phh)  
[Zod Tutorial | Total TypeScript](https://www.totaltypescript.com/tutorials/zod)  
[Fixing TypeScriptâ€™s Blindspot: Runtime Typechecking - YouTube](https://www.youtube.com/watch?v=rY_XqfSHock)  
[GitHub - colinhacks/zod: TypeScript-first schema validation with static type inference](https://github.com/colinhacks/zod)  
[Type-safe React Query | TkDodoâ€™s blog](https://tkdodo.eu/blog/type-safe-react-query)
