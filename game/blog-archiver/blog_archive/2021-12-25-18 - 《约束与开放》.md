---
title: "18 - 《约束与开放》"
date: 2021-12-25
url: https://sorrycc.com/constraints
---

发布于 2021年12月25日

# 18 - 《约束与开放》

> SEE Conf 分享的其中一部分底稿。

社区同学经常一方面抱怨 Umi 太黑盒，一方面又抱怨这么多选择，我应该选哪个；蚂蚁内部同学经常抱怨内置方案我不喜欢，能否换一个？

之所以有这个问题，归根结底还是场景不同。是个人还是团队，是同一个团队还是不同团队。团队需要一致性。到达终点的路很多，但这些路在一个团队内却不应该放开让大家选。

所以「社区要开放，团队要约束」。然后约束要有度。约束越多，越一致。但又不能把路堵死，堵久了容易固步自封。

蚂蚁内部有 50 条「强约束」规则集，目的除了方案和编码一致性，还可以提升安全性、规避常见错误、提升可维护性等。为了让这些规则不像 eslint 可以在本地轻易跳过，采取了服务器下发的方式。

举一些规则的例子。比如不能使用除 dva、use model 之外的数据流方案，不能无理由使用 eval、new Function、不能混用 cjs 和 esm 模块规范，组件代码不能超过 600 行，不能使用 resolution 锁定一方库和二方库版本。

还有个特殊规则是同一 major version 下「只能使用框架最新版」，这使得我们全局只有一个框架版本，对于框架升级和应用治理都有很大帮助。

再来看社区的方案。面向社区的 Umi 框架会更倾向「原子功能 + 组装」的使用方式，尽量白盒，相比「集中式」用户会有更多控制权。

举个例子，比如提供功能 A，集中式是配置 A: {} 开启，组装式是分别提供 base 和 A，用户通过 A + base 的方式开启。再具体点比如 jest 配置，Umi 4 的组装式是在 jest.config.ts 里配置 export default configUmiAlias(createConfig(opts))，把 createConfig 和 configUmiAlias 做个组装。

One More Thing，蚂蚁内部强约束的规则集会在 SEE Conf 分享中公开，可能会大家会有些借鉴意义。
