---
title: "401 - 《博客》"
date: 2024-01-14
url: https://sorrycc.com/blog
---

发布于 2024年1月14日

# 401 - 《博客》

![](https://img.alicdn.com/imgextra/i3/O1CN01skQNrA1RKBUHSzd4j_!!6000000002092-0-tps-1920-1280.jpg_1200x1200.jpg)

题图：markuswinkler @ unsplash.com

用 WordPress 搭完 [sorrycc.com](http://sorrycc.com) 后，做下记录。

![](https://img.alicdn.com/imgextra/i2/O1CN01kQGBQH1D3KI8OF4MD_!!6000000000160-2-tps-2014-1554.png_1200x1200.jpg)

**1、为啥选 WordPress？**

其实纠结了一会。本着折腾的心态，我第一时间考虑的是用 next/umi + contextlayer + tailwindcss + twc + shadcn/ui + supabase 等搭一个，既能享受技术的乐趣，又学了新东西，说不定还能沉淀个开源脚手架。但想了想后还是忍住了，选了 WordPress。

几个原因，1）省心，博客的主要目的是写，我不想花时间折腾其他的，比如性能优化、迭代升级、数据备份、样式美化等，2）生态，WordPress 的生态很丰富，想要什么基本都有别人已经实现过，装个插件就可以，万一想要扩展点啥，比如会员系统，也无需自己动手，3）虽然 WordPress 原生不支持 Markdown，但他有 xmlrpc 接口，作为程序员，动动手把 Markdown 转成 HTML， 然后利用 xmlrpc 接口可以做到发布自动化，完全不是问题。

![](https://img.alicdn.com/imgextra/i3/O1CN01LqtQ6l1TuU76hgskQ_!!6000000002442-2-tps-2380-1364.png_1200x1200.jpg)

**2、主机。**

我用的是 [CloudClone](https://app.cloudcone.com/?ref=10409) 的 VPS，2 CPU 2G，一年 $29，在 [353 - 《VPS、宝塔、Blog》](https://sorrycc.com/vps-baota-blog) 里有过介绍。

![](https://img.alicdn.com/imgextra/i1/O1CN01NiC6mj1JqEHBBbr7O_!!6000000001079-2-tps-2344-1096.png_1200x1200.jpg)

注：不想自己折腾主机的可以选平台服务，比如 [wordpress.com](http://wordpress.com) 官网、[www.hostinger.com.hk](http://www.hostinger.com.hk) 等。

**3、域名。**

用过 [name.com](http://name.com)、[vercel.com](http://vercel.com) 和 [cloudflare.com](http://cloudflare.com) 等，各有优势，[name.com](http://name.com) 相对便宜点，但管理界面不好用。现在这个 [sorrycc.com](http://sorrycc.com) 是在 [name.com](http://name.com) 注册，然后指到 [vercel.com](http://vercel.com) 做域名管理。

**4、环境搭建。**

基于宝塔面板搭建，选 LNMP（Linux、Nginx、Mysql、PHP），创建 PHP 站点，安装 WordPress，全程半小时应该能搞定，见 [353 - 《VPS、宝塔、Blog》](https://sorrycc.com/vps-baota-blog)。

![](https://img.alicdn.com/imgextra/i1/O1CN012vRIOn24D6LUTA9vI_!!6000000007356-2-tps-2454-1324.png_1200x1200.jpg)

**5、插件。**

我在用的插件如下，比较简单。1）[FluentSMTP](https://wordpress.org/plugins/fluent-smtp/)，免费的 SMTP 插件，支持 Amazon SES，备选 [MailPoet](https://wordpress.org/plugins/mailpoet/)，官方注册审核通过过免费额度应该就够用，2）[Site Kit by Google](https://wordpress.org/plugins/google-site-kit/)，集成 Google Analytics 到 WordPress 后台，可以看站点的访问情况，3）[WPvivid 备份插件](https://cn.wordpress.org/plugins/wpvivid-backuprestore/)，备份用，设置一次再也不用担心数据丢失，我是备份到 Google Drive，4）[Ultimate Member](https://wordpress.org/plugins/ultimate-member/)（终极会员），免费，虽然没有在线支付的能力，但已能满足我的需求，可以为某个类目提供保护，在会员登录后才能翻完（注：他好像不会拦截全文输出的 RSS，需要改成摘要输出）。

![](https://img.alicdn.com/imgextra/i3/O1CN01X383RY1H4TkY0H0HE_!!6000000000704-2-tps-1562-1178.png_1200x1200.jpg)

注：我没有用 Markdown 和语法高亮的插件，因为我的发布脚本会做 Markdown 到 Html 的转换，以及做语法高亮的转换。

**6、主题。**

我用的 [Davis](https://andersnoren.se/themes/davis/)，除此之外，做了两个自定义，CSS 和菜单。

1）额外 CSS。作为程序员，还是会写点带代码的文章的。

```css
pre {
  background: #f9f9f9 !important;
  padding: 12px 20px;
  font-size: 0.8em;
}
code, code span {
  font-family: Menlo, Monaco, 'Courier New', monospace !important;
}
p > code {
  background: #f9f9f9 !important;
  font-size: .9rem;
  padding: 3px 6px;
}
```

2）菜单上没有登录和退出，这在我加了会员体系后是需要的，ChatGPT 一把后，方案是在 `functions.php` 里加一段。

```php
if ( ! function_exists( 'add_login_logout_register_menu' ) ) :
	function add_login_logout_register_menu( $items, $args ) {
		if ( is_user_logged_in() ) {
			$items .= '<li class="menu-item"><a href="/logout">' . __('登出') . '</a></li>';
		} else {
			$items .= '<li class="menu-item"><a href="/login">' . __('登录') . '</a></li>';
		}
		return $items;
	}
	add_filter( 'wp_nav_menu_items', 'add_login_logout_register_menu', 10, 2 );
endif;
```

**7、发布。**

我本地用 Obsidian 写文章和做记录，所以需要让 WordPress 支持 Markdown 发布，先试了 [obsidian-wordpress](https://github.com/devbean/obsidian-wordpress) 插件，但明显不够用，于是基于 [node-wordpress](https://github.com/scottgonzalez/node-wordpress) + markdown-it 写了个脚本，效果如下。

![](https://img.alicdn.com/imgextra/i1/O1CN01ocsk6n1xajVJKDmMP_!!6000000006460-1-tps-608-362.gif)

我的脚本包含很多个人需求，比如图片上传、双链替换、自动链接、删除首行标题、删除 EOF 后的内容、支持 wip 等，比较乱。大家感兴趣可以自行实现，主要就以下两个功能。

1）Markdown 转 Html，并支持语法高亮。

```ts
import Shikiji from 'markdown-it-shikiji';
import MarkdownIt from 'markdown-it';
const md = new MarkdownIt({
  html: true,
  linkify: true,
  typographer: true
});
md.use(await Shikiji({
  theme: 'github-light',
}));
let html = md.render(mdContent);
```

2）发布 html 到 wordpress。

```ts
import wordpress from 'wordpress';
const client = wordpress.createClient({
  url: WP_XMLRPC_URL,
  username: WP_USERNAME,
  password: WP_TRANSLATE_PASSWORD,
});
const data = {
  content,
  title,
  name,
  type,
  date,
  termNames,
  status: 'publish',
};
client.newPost(data, (err, id) => {});
```

参考：  
[如何快速搭建一个自己的WordPress博客 – 衛斯理](https://imwsl.com/?p=67)  
[如何搭建一个博客？ | 印记](https://yinji.org/5223.html)  
[WordPress如何发送邮件设置教学，三种免费插件推荐 - YouTube](https://www.youtube.com/watch?v=Kvc4Y5DDX6Q)  
[XML-RPC WordPress API « WordPress Codex](https://codex.wordpress.org/XML-RPC_WordPress_API)
