---
title: "415 - 《JSR》"
date: 2024-02-28
url: https://sorrycc.com/jsr
---

发布于 2024年2月28日

# 415 - 《JSR》

收到 JSR 的邀请了，试用了下，简单做下笔记。

1、jsr 是啥？

jsr 全称 javascript registry，是 deno 团队新出的 package registry。注意是 package registry，不是 package manager。所以竞品是 npm registry，不是 npm、yarn、pnpm 等。

jsr 是 npm 的超集。你可以在 jsr 模块里导入 npm 依赖。

2、为啥有了 npm 之后还要有 jsr？

因为 jsr 觉得随着社区的发展，现在已经是 esm + typescript 的时代。npm registry 这种还用着（或者说没有约束） javascript + cjs 的显然已经落伍。同时，npm registry 的用户除了 node，现在还有 deno、bun、workerd 等其他 javascript 环境，围绕着 node 做 registry，然后其他环境对其做兼容的方式并不合理。

3、jsr 的特点是啥？

esm only + typescript only。

typescript only 指你只需要写 typescript，发布 typescript 的包。然后如果你要在 node 生态用，jsr 会生成兼容层，包括转 javascript 和生成 d.ts 文件。感觉 jsr 叫 tsr 更合适一些。。

jsr 还会基于 typeScript 生成文档。当然这是有成本的，因为 typescript 的一些约定（推导、declare module 模块声明等）会导致 jsr 不那么好做推导，所以在 jsr 里写 typescript 会有一些[对 slow type 的约束](https://jsr.io/docs/about-slow-types)。

3、如何发包到 jsr？

```bash
$ vi mod.ts
export const foo = 1;

$ vi jsr.json
{
  "name": "@sorrycc/test",
  "version": "0.0.1-alpha.1",
  "exports": "./mod.ts"
}

$ npx jsr publish
```

注：有 jsr 邀请的同学可以[先占个位](https://jsr.io/new)。

![](https://img.alicdn.com/imgextra/i2/O1CN016CpxY21OzSLHjbx0c_!!6000000001776-2-tps-1432-702.png)

4、如何使用 jsr？

两种方法，deno 和 node。

1）在 deno 下使用。

```bash
$ vi main.ts
import { printProgress } from "jsr:@luca/flag@1";
printProgress();

$ deno run main.ts
```

2）在 Node 下使用。

```bash
$ npx jsr add @luca/flag
```

这背后主要是添加了一个 `.npmrc`，把 `@jsr` scope 的源指向 [npm.jsr.io](http://npm.jsr.io) 。

```
@jsr:registry=https://npm.jsr.io
```

然后在 package.json 中把 `@luca/flag` 指向这个源的指定包。

```json
{
  "dependencies": {
    "@luca/flag": "npm:@jsr/luca__flag@^1.0.1"
  }
}
```

5、jsr 开源吗？

开，MIT 协议。只是目前尚未公布，公布时间点应该在正式发布后。

参考：  
[https://jsr.io/](https://jsr.io/)  
[https://github.com/jsr-io/jsr](https://github.com/jsr-io/jsr)  
[https://www.npmjs.com/package/jsr](https://www.npmjs.com/package/jsr)
