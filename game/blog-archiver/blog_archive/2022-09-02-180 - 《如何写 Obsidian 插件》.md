---
title: "180 - 《如何写 Obsidian 插件》"
date: 2022-09-02
url: https://sorrycc.com/how-to-write-obsidian-plugin
---

发布于 2022年9月2日

# 180 - 《如何写 Obsidian 插件》

下午翻了下 Obsidian 插件的资料，做下笔记。从中也可以学习到一个 UI 类的应用可以如何设计插件体系，相比我们之前做的 Umi UI 的插件体系高级多了。

1、如何快速上手？

➀ 启动插件项目。

```bash
$ git clone git@github.com:obsidianmd/obsidian-sample-plugin.git
$ cd obsidian-sample-plugin
# 复制插件路径
$ pwd | pbcopy
$ npm i
$ npm run dev
```

➁ Link 到 Obsidian 知识库的 .obsidian/plugins 目录。

```bash
$ cd path/to/obsidian/知识库
$ cd .obsidian/plugins
$ ln -sf $(pbpaste)
```

➂ 打开「Obsidian > 配置 > 第三方插件」，搜索「sample」找到此插件，开启。

➃ 重启 Obsidian 生效（或者按「⌘+⌥+I」打开开发者工具，按「⌘+R」刷新，这是大部分教程里没有提到的）

2、obsidian-sample-plugin 的工程化和结构？

整体目录结构如下，

```
# 有用的文件
- main.ts
- main.js
- style.css
- manifest.json
- versions.json

# 工程化脚本
- esbuild.config.mjs
- version-bump.mjs
```

Obsidian 插件主要是这些文件，main.js、style.css、manifest.json 和 versions.json。main.js 用于加功能；style.css 用于自定义样式，可以不存在；manifest.json 是插件基本信息；versions.json 里维护了插件版本和要求的 Obsidian 版本的隐射关系，也可理解为 peerDependencies 映射表。

obsidian-sample-plugin 包含两个 script，esbuild.config.mjs 和 version-bump.mjs。前者用于把 main.ts 编译成 main.js，dev 模式下会生成 sourcemap 同时开启 watch 持续构建；后者用于更新版本和更新维护最小可用版本映射表的 versions.json。

3、Obsidian 插件能做哪些事？

可以先从 4000+ 行的 API [https://github.com/obsidianmd/obsidian-api/blob/master/obsidian.d.ts](https://github.com/obsidianmd/obsidian-api/blob/master/obsidian.d.ts) 里看个大概。

具体能做的事包括，

*   和编辑器互动
*   添加命令
*   添加上下文菜单
*   添加插件设置项
*   添加右侧边栏
*   通过 Modal 弹窗进行互动
*   修改状态栏
*   操作 Workspace

4、可以用 React 吗？

Obsidian 里有 View 的概念，他本身的资源管理器、关系图预览、Markdown 预览等也是 View。在 View 的类里可以拿到 container，所以理论上可以和任意前端框架结合使用。

比如。

```ts
import { createRoot } from 'react-dom/client';
export class ExampleView extends ItemView {
  async onOpen() {  
    const container = this.containerEl.children[1];
    createRoot(container).render(<div>hello obsidian</div>);
  }
}
```

5、如何发布插件？

自用的话本地 Link 过来就可以，要让更多人用的话就要走官方流程了。

➀ 确保有 [README.md](http://README.md)、LICENSE  
➁ 走 github 发布，注意不要到 v 前缀，发布 assets 里包含 main.js、manifest.json 和可选的 styles.css（可以用 Github Action 简化发布流程）  
➂ 给 [https://github.com/obsidianmd/obsidian-releases](https://github.com/obsidianmd/obsidian-releases) 给 PR 加上你的插件

参考：  
[https://github.com/obsidianmd/obsidian-sample-plugin](https://github.com/obsidianmd/obsidian-sample-plugin)  
[https://github.com/obsidianmd/obsidian-api](https://github.com/obsidianmd/obsidian-api)  
[https://marcus.se.net/obsidian-plugin-docs/](https://marcus.se.net/obsidian-plugin-docs/)  
[https://github.com/obsidianmd/obsidian-releases/blob/master/plugin-review.md](https://github.com/obsidianmd/obsidian-releases/blob/master/plugin-review.md)
