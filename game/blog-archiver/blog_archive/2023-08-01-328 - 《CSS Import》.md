---
title: "328 - 《CSS Import》"
date: 2023-08-01
url: https://sorrycc.com/css-import
---

发布于 2023年8月1日

# 328 - 《CSS Import》

> 工作需要，深入了解了下 CSS Import 相关的知识。

1、`@import url("foo.css")` 和 `@import "foo.css"` 效果完全一致。

2、`@import url("foo.css")` 引用的是相对路径的 foo.css，而不是 node\_modules 依赖里的 foo.css npm 包。注意，这和 JS 里 import 和 require 的逻辑是不同的。那怎么在 CSS 里 import npm 包依赖？webpack 的约定是用「~」前缀，比如 `@import url("~foo.css")` 。

3、CSS 里通过 url 引用 assets 比如图片、字体时，始终是以当前 CSS 路径开始去找相对路径，所以无需像 JS 里一样去加 publicPath。

4、CSS 里的 @import 顺序和 JS 里的 import 的导入顺序（或者叫优先级）是不同的。JS 里已 import 的模块不会重复执行，以第一次为准；CSS 里 @import 的模块会重复 @import，而由于 CSS 里的优先级规则，所以会以最后一个为准。

比如：

```css
/* index.css */
@import "a.css";
@import "b.css";

/* a.css */
@import "c.css";
.a {}

/* b.css */
@import "c.css";
.b {}

/* c.css */
.c {}
```

那产物会是这样。

```css
.c {}
.a {}
.c {}
.b {}
```

而由于 .c {} 是重复的，在有些构建工具里会自动删掉第一个 .c {}。比如 esbuild 里会做删除的事，而 webpack 里不会。

对比下，如果用 JS 的逻辑来引用 CSS。

```css
// index.js
import 'a.js';
import 'b.js';

// a.js
import 'c.css';
import 'a.css';

// b.js
import 'c.css';
import 'b.css';

/* a.css */
.a {}

/* b.css */
.b {}

/* c.css */
.c {}
```

那 CSS 的结果会是这样。

```css
.c {}
.a {}
.b {}
```

再补一个 JS 重复 import CSS 的场景。

```css
/* index.js */
import "./reset.css";
import "./a.css";
import "./reset.css";
import "./b.css";

/* reset.css */
.reset {}

/* a.css */
.a {}

/* b.css */
.b {}
```

CSS 产物是这样，reset 只会出现一次且出现在第一次出现的地方。

```css
.reset {}
.a {}
.b {}
```

5、CSS 里的 @import 语句如果不在最前面会怎么样？

> Any @import rules must precede all other valid at-rules and style rules in a style sheet (ignoring @charset and @layer statement rules) and must not have any other valid at-rules or style rules between it and previous @import rules, or else the @import rule is invalid.

规范里是这么说的，浏览器也是这么执行的，非前置的 @import 一律无效。但是不同构建工具的处理不同。

比如 webpack，会把 @import 提到最前面。

```css
.foo {}
@import "a.css";
.bar {}
@import "https://b.com/b.css";
```

会被处理成这样。

```css
@import "a.css";
@import "https://b.com/b.css";
.foo {}
.bar {}
```

比如 esbuild，会抛个警告，然后不处理不合法的 @import 。

6、@import 语句有一些高级语法，比如加 @supports、layer 等。

```css
/* index.css */
@import "foo.css" layer(default);
.index {}

/* foo.css */
.foo1 {}
.foo2 {}
```

打包之后，会把这个条件附加到所有被 @import 的 CSS 文件里。

```css
layer(default) {
  .foo1 {}
}
layer(default) {
  .foo2 {}
}
.index {}
```

参考：  
[@import - CSS: Cascading Style Sheets | MDN](https://developer.mozilla.org/en-US/docs/Web/CSS/@import)  
[Release v0.12.0 · evanw/esbuild · GitHub](https://github.com/evanw/esbuild/releases/tag/v0.12.0)  
[CSS Cascading and Inheritance Level 5](https://drafts.csswg.org/css-cascade-5/#at-import)  
[https://yuque.antfin.com/verifyidentity/frontend/hnfe5my75gzmoxgr?singleDoc#](https://yuque.antfin.com/verifyidentity/frontend/hnfe5my75gzmoxgr?singleDoc#)
