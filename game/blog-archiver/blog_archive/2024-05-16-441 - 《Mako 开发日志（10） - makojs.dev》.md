---
title: "441 - 《Mako 开发日志（10） - makojs.dev》"
date: 2024-05-16
url: https://sorrycc.com/mako-devlog-10
---

发布于 2024年5月16日

# 441 - 《Mako 开发日志（10） - makojs.dev》

![](https://res.cloudinary.com/sorrycc/image/upload/v1715765756/blog/shqyz00h.png)

1、手动搭了个 mako 的官网， [https://makojs.dev/](https://makojs.dev/) ，没有用任何文档站工具，包括 dumi、vitepress、docuraurus 等。原因是，1）看腻了，各官网都千篇一律，想尝试点不一样的，2）官网技术栈应该可以很简单，不需要 tailwind.css，不需要 ssr & ssg，也不需要 react、vue 等框架，简单的 markdown 转 html，然后加点样式和脚本就够了，回归 10 年前的技术栈，3）初始上线时内容较少，类 esbuild 官网的这种结构看起来内容会更丰富一些。

2、部署参考 [437 - 《VPS》](https://sorrycc.com/vps)，部署在搬瓦工的机器上，国内访问还是挺快的，不需要翻墙，用 1Panel 面板，https 啥的读一键搞定，部署目前文档量不多，用的最原始的 scp 文件上传。

3、说下实现。

1）article 部分的样式直接问 chatgpt 要来的，还挺好看。

2）布局是左右结构，左侧 sticky 显式在固定位置，需要注意的是 flex 下不能直接 sticky，需要套一层。

```html
// 这样不行
<display: flex>
  <position: sticky />
</display: flex>

// 这样可以
<display: flex>
  <div><position: sticky /></div>
</display: flex>
```

3）做了简单的响应式，当 < 800px 时，会切到小屏模式，隐藏左侧菜单，此时通过点击页头图标会给外部元素加 .open 样式，唤出左侧菜单。

```css
/* 左侧菜单 */
aside { display: none }
@media (min-width: 800px) {
  aside { display: block }
}
.open aside { display: block }

/* 顶部菜单 */
.menubar { display: none }
@media (min-width: 800px) {
  .menubar { display: block }
}
```

4）锚点菜单高亮。找到 viewport 里的第一个锚点，和左侧菜单做 url 比对，一致的加粗显示。

```ts
function highlightNav() {
  let headerAnchor = getFirstVisibleHeaderAnchor();
  let navs = document.querySelectorAll(...);
  navs.forEach(nav => {
	// ...
  });
}
window.addEventListener('scroll', highlightNav);
highlightNav();
```

5）markdown 转 html 用的 markdown-it。a）布局只有一个，用的 ejs 模版，b）高亮用 markdown-it-shikiji，注意得用 0.9.x，c）锚点用 markdown-it-anchor。

```ts
import Shikiji from 'markdown-it-shikiji';
import anchor from 'markdown-it-anchor';
import MarkdownIt from 'markdown-it';

let md = new MarkdownIt({
  html: true,
  linkify: true,
  typographer: true
});
md.use(await Shikiji({
  theme: 'github-light',
}));
md.use(anchor, {
  permalink: anchor.permalink.linkInsideHeader({
    symbol: `
      <span aria-hidden="true">#</span>
    `,
    placement: 'after'
  })
});
let html = md.render(body);
```

6）博客和 rss 是基于前者包了个 collection，把 blog 目录下的 markdown 文件做收集、分析和排序，用 yaml 声明 publishedAt 字段作为发布时间排序，然后用 feed 这个 npm 包生成 rss。

```ts
import { Feed } from 'feed';

let baseUrl = 'https://makojs.dev';
let feed = new Feed({
  link: baseUrl,
  id: 'rss@makojs.dev',
  title: 'Mako Blog',
  description: `Extremely fast, Production-grade web bundler.`,
  copyright: `sorrycc@gmail.com`,
});
for (let md of this.#mdFiles) {
  let url = `${baseUrl}/blog/${md.file.replace(/\.md$/, '')}`;
  let content = await Markdown.parseMarkdown(md.body);
  feed.addItem({
    id: url,
    link: url,
    title: md.attributes.title,
    content,
    date: new Date(md.attributes.publishedAt),
  });
}
fs.writeFileSync('dist/rss.xml', feed.atom1(), 'utf-8');
```

7）icon 我用的 [https://iconmonstr.com/](https://iconmonstr.com/) 。

4、还留了一些坑要填，但优先级不高。比如多语言、基于 css 变量的暗黑主题、搜索、页面切换 SPA 化、[og meta](https://ogp.me/)、评论、埋点监控等。
