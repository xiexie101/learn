# 且慢消息列表抓取与智能摘要设计方案

## 1. 项目背景
用户希望抓取且慢应用的消息列表 (`https://qieman.com/inbox`) 中的每一条消息详情，提取内容摘要，并最终输出为一个包含时间、概要、详情的 Markdown 文件。

## 2. 核心需求
- **目标网站**: `https://qieman.com/inbox`
- **鉴权方式**: 连接本地已登录的 Chrome 浏览器实例（通过 Remote Debugging Port），避免复杂的自动化登录验证。
- **列表处理**: 识别并处理"加载更多"按钮，以获取完整或指定数量的消息列表。
- **内容处理**:
    - 进入每条消息的详情页抓取正文。
    - 使用大模型 API 对内容进行智能摘要和关键信息提取。
- **输出格式**: Markdown 文件，包含时间、概要、详情。

## 3. 技术架构

### 3.1 技术栈
- **语言**: Node.js (TypeScript) / Python (可选，根据当前项目偏好，暂定 Node.js 因为 Playwright 支持良好且适合处理异步 IO)
- **核心库**: `Playwright` (用于连接浏览器和页面操作)
- **AI 整合**: `OpenAI SDK` 或兼容的 API 客户端 (用于调用 LLM 生成摘要)

### 3.2 流程设计
1.  **初始化**:
    - 连接到 `http://localhost:9222` (默认调试端口) 的 Chrome 实例。
    - 获取当前上下文，打开新标签页或复用现有标签页访问 `https://qieman.com/inbox`。

2.  **列表抓取**:
    - 循环检测页面底部的"加载更多"按钮。
    - 自动点击并等待原本加载，直到满足停止条件（如抓取条数上限或无更多内容）。
    - 解析列表中的消息项，提取消息 ID 和详情页 URL。

3.  **详情抓取 (并发/队列控制)**:
    - 遍历列表中的 URL。
    - 导航至详情页，提取正文内容 (HTML 或纯文本)。
    - 根据消息时间戳进行初步去重（可选）。

4.  **智能摘要**:
    - 构建 Prompt，输入详情页内容。
    - 要求模型输出 JSON 格式或特定结构的文本，包含：
        - `summary`: 一句话概要
        - `details`: 关键点详情列表
        - `date`: 如果正文中包含特定时间，优先提取，否则使用列表页时间。

5.  **结果聚合**:
    - 将所有处理后的数据格式化为 Markdown。
    - 保存到本地文件。

## 4. 关键交互细节
- **"加载更多"处理**: 需要设置合理的点击间隔和超时等待，通过 DOM 变化判断新内容是否加载成功。
- **AI API 配置**: 需要从环境变量或配置文件中读取 API Key 和 Base URL。

## 5. 输出示例 (Markdown)

```markdown
# 且慢消息汇总

## 2024-01-19 | 孟岩的投资周报
- **概要**: 本周市场波动较大，建议保持定投节奏。
- **详情**:
    1. 沪深300指数下跌 1.5%。
    2. 且慢组合表现稳定。
    3. 建议关注债市回调机会。
[原文链接](https://qieman.com/inbox/...)

---
...
```
