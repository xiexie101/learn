# CloudRoam Active (云游·不老松) 实现计划

## 1. 项目概览
**目标:** 为“云游·不老松” (CloudRoam Active) 构建一个 Web 端 MVP，这是一款利用身体重心交互的老年康复数字疗法游戏。
**技术栈:** 原生 HTML5, CSS3, JavaScript.
**依赖:** Google MediaPipe BlazePose (通过 CDN).
**平台:** 移动端/平板 Web 浏览器 (运行在本地服务器上).

## 2. 架构与文件结构
```
/Users/xieshijin/jin/learn/ai/cloudroam/
├── index.html          # 入口文件，UI 容器
├── css/
│   └── style.css       # UI 和 Canvas 的样式
├── js/
│   ├── main.js         # 应用入口，状态管理
│   ├── pose.js         # MediaPipe 集成与重心检测
│   ├── game.js         # Canvas 渲染与游戏循环
│   └── audio.js        # 音效管理器 (占位)
└── assets/             # 图片/图标 (初期使用占位符)
    └── images/
```

## 3. 详细实施任务

### 第一阶段：基础搭建
**目标:** Hello World 并显示摄像头画面。
1.  **创建目录:** `mkdir -p cloudroam/css cloudroam/js cloudroam/assets/images`
2.  **`index.html`:**
    *   添加 `<video>` 元素用于摄像头输入 (隐藏或调试视图)。
    *   添加 `<canvas>` 用于游戏渲染。
    *   添加 UI 覆盖层 (开始按钮, 分数, 调试信息)。
    *   通过 CDN 引入 MediaPipe 库。
3.  **`css/style.css`:**
    *   重置 CSS (Reset CSS)。
    *   全屏布局。
    *   覆盖层样式。

### 第二阶段：姿态检测核心 (`js/pose.js`)
**目标:** 检测“身体摆动” (向左/向右倾斜)。
1.  **初始化 MediaPipe Pose:**
    *   加载 `Pose` 解决方案。
    *   配置选项 (移动端 modelComplexity: 1, smoothLandmarks: true)。
2.  **摄像头设置:** 使用 `@mediapipe/camera_utils` 将视频流传输给 Pose。
3.  **摆动逻辑:**
    *   获取关键点: `鼻尖 (Nose)` (0) 和 `髋部中点 (Mid-Hip)` (点 23 和 24 的中点)。
    *   计算水平偏差: `diff = Nose.x - MidHip.x`。
    *   **校准:** 启动时，记录“中立 (Neutral)”位置。
    *   **控制信号:**
        *   `diff < -0.05` -> 向左倾 (Lean Left)
        *   `diff > 0.05` -> 向右倾 (Lean Right)
        *   否则 -> 居中 (Center)
4.  **调试可视化:** 在调试画布上绘制骨骼点以进行验证。
5.  **测试:** 验证倾斜动作是否触发日志输出。

### 第三阶段：游戏循环与渲染 (`js/game.js`)
**目标:** 由身体摆动控制的无尽跑酷机制。
1.  **Canvas 设置:** 2D 上下文，响应式尺寸。
2.  **玩家实体:**
    *   视觉: 简单形状 (圆形/旅行者图标)。
    *   移动: 基于 `pose.js` 的“控制信号”平滑插值 X 轴位置。
3.  **世界生成:**
    *   **道路:** 透视绘制 (梯形)。
    *   **物品 (奖励):** “特产” (如：龙井茶, 玩偶)在地平线处生成。
    *   **障碍 (惩罚):** “水坑”在地平线处生成。
    *   将 Z 深度移向玩家，放大尺寸，检查碰撞。
4.  **游戏循环:** `requestAnimationFrame` -> 更新状态 -> 清除画布 -> 绘制道路 -> 绘制实体 -> 绘制玩家。

### 第四阶段：游戏逻辑与 UI (`js/main.js`)
**目标:** 完整的游戏流程。
1.  **状态机:** `INIT` (初始化) -> `CALIBRATING` (校准中) -> `PLAYING` (游戏中) -> `GAME_OVER` (游戏结束)。
2.  **交互:**
    *   **碰撞检测:** 计算玩家与物品/障碍物之间的简单距离。
    *   **计分:** 收集物品加分，撞到障碍物屏幕震动。
3.  **UI 反馈:**
    *   收集时弹出 "Perfect!" (太棒了)。
    *   撞击时弹出 "Watch out!" (小心)。
    *   分数显示。
4.  **无障碍性:** 高对比度颜色，大字体 (>36pt)。

### 第五阶段：验证与打磨
1.  **浏览器测试:** 在 `cloudroam/` 目录下运行 `python3 -m http.server` 并在 Chrome 中测试。
2.  **真机测试:** 手机通过局域网 IP 访问。
3.  **调优:** 根据体感调整摆动阈值。

## 4. 验证计划

### 自动化测试
*   *注意: 鉴于视觉/硬件交互性质 (摄像头)，标准单元测试受限。我们将专注于逻辑测试。*
*   **逻辑测试:** 创建一个简单的 HTML 测试工具 `test_logic.html`，模拟 Pose 数据并断言游戏状态变化 (例如: "模拟左倾 -> 玩家 X 坐标减小")。

### 手动验证
1.  **摄像头权限:** 浏览器是否请求摄像头访问权限？
2.  **姿态追踪:** 打开调试视图。骨骼点是否与身体对齐？
3.  **控制:**
    *   直立 -> 玩家居中？
    *   左倾 -> 玩家左移？
    *   右倾 -> 玩家右移？
4.  **玩法:**
    *   能否收集物品？(分数增加)
    *   能否撞到障碍？(视觉反馈)
5.  **性能:** 目标设备上帧率是否流畅？

## 5. 开发人员下一步
1.  阅读本计划。
2.  执行第一阶段 (基础搭建)。
3.  验证摄像头访问。
4.  进入第二阶段。
