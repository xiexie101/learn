# Ethereal Touch 设计方案

> 文档日期: 2025-12-26  
> 版本: 1.0

## 概述

Ethereal Touch 是一个基于浏览器的手势交互粒子系统，通过摄像头捕捉用户手部动作，驱动 3D 粒子产生聚合、扩散、变形等视觉效果，打造"指尖魔法"的沉浸式体验。

## 设计目标

1. **零门槛体验** - 无需安装任何软件，浏览器即可运行
2. **实时响应** - 手势到视觉反馈延迟 < 50ms
3. **视觉震撼** - 赛博朋克美学，粒子效果精致流畅
4. **直觉交互** - 手势语义清晰，无需学习成本

## 系统架构

```
┌─────────────────────────────────────────────────────┐
│                    用户层                            │
│   摄像头输入 ──▶ 手势展示 ──▶ 视觉反馈              │
└─────────────────────────────────────────────────────┘
                        │
┌─────────────────────────────────────────────────────┐
│                   识别层                             │
│   MediaPipe Hands                                   │
│   ├── 21 个手部关键点                               │
│   └── 实时坐标流                                    │
└─────────────────────────────────────────────────────┘
                        │
┌─────────────────────────────────────────────────────┐
│                   处理层                             │
│   ├── 法向量计算（手掌朝向）                         │
│   ├── 侧立系数 (verticalFactor)                     │
│   └── 响指检测 (thumbTip ↔ middleTip)              │
└─────────────────────────────────────────────────────┘
                        │
┌─────────────────────────────────────────────────────┐
│                   渲染层                             │
│   Three.js                                          │
│   ├── MainParticleSystem (3000 粒子)                │
│   └── SnapSystem (60 粒子)                          │
└─────────────────────────────────────────────────────┘
```

## 核心模块设计

### 1. 主粒子系统 (MainParticleSystem)

**职责**: 根据手势状态呈现不同形态的粒子云

| 属性 | 说明 |
|------|------|
| `count` | 3000 个粒子 |
| `shapes` | ['SPHERE', 'RING', 'HEART'] |
| `targetPositions` | 当前目标形状的粒子分布 |

**形状生成算法**:

- **球体 (SPHERE)**: 立方根半径 + 球面均匀采样
- **圆环 (RING)**: 环面参数方程 + 管径随机化
- **爱心 (HEART)**: 2D 心形方程 + Z 轴厚度

**行为逻辑**:

```
IF 手掌平摊 (verticalFactor < 0.4) AND 未锁定:
    触发形状切换
    锁定状态

IF 手掌侧立 (verticalFactor > 0.6):
    解锁状态

粒子位置 = 手部悬浮位 + (目标形状位置 × 扩散系数) + 噪声
```

### 2. 响指特效系统 (SnapSystem)

**职责**: 检测拇指-中指捏合，产生蓄力爆发效果

**状态机**:

```
IDLE ──(捏合)──▶ CHARGING ──(松开)──▶ EXPLODING ──(动画结束)──▶ IDLE
```

| 状态 | 视觉表现 |
|------|----------|
| CHARGING | 青白色光点紧缩抖动 |
| EXPLODING | 金黄色光球扩散 + 旋转 |

### 3. 手势数据处理

**关键计算**:

1. **法向量**: `cross(indexMCP - wrist, pinkyMCP - wrist)`
2. **侧立系数**: `smoothstep(abs(normal.x), 0.3, 0.8)`
3. **悬浮位置**: `palmCenter + normal * hoverDist`
4. **捏合检测**: `thumbTip.distanceTo(middleTip) < 2.5`

## 视觉设计

### 配色方案

| 元素 | 颜色 | 用途 |
|------|------|------|
| 主粒子 | `#00ffff` | 青色，主视觉 |
| 蓄力光 | `#aaffff` | 青白，紧张感 |
| 爆发光 | `#ffaa00` | 金黄，释放感 |
| UI 边框 | `#00ffcc` | 霓虹绿，赛博风 |
| 背景 | `#000000` | 纯黑，深邃 |

### 渲染特效

- **叠加混合** (Additive Blending): 光晕效果
- **指数雾** (FogExp2): 增加深度感
- **灰度摄像头**: 降低干扰，突出粒子

## 性能优化

1. **BufferGeometry**: 直接操作类型化数组
2. **Lerp 平滑**: 避免突变，降低 CPU 负载
3. **设备像素比限制**: `min(devicePixelRatio, 2)`
4. **requestAnimationFrame**: 同步浏览器刷新率

## 未来迭代方向

- [ ] 双手交互支持
- [ ] 更多形状预设（星形、螺旋、DNA 双螺旋）
- [ ] 音效反馈
- [ ] 粒子拖尾效果
- [ ] VR/AR 模式

## 参考资料

- [MediaPipe Hands](https://google.github.io/mediapipe/solutions/hands.html)
- [Three.js Documentation](https://threejs.org/docs/)
- [WebGL Best Practices](https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices)
